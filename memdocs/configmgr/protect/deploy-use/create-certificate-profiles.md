---
title: 创建 SCEP 证书配置文件
titleSuffix: Configuration Manager
description: 了解如何使用证书配置文件为受管理设备预配证书
ms.date: 11/29/2019
ms.prod: configuration-manager
ms.technology: configmgr-protect
ms.topic: conceptual
ms.assetid: 634d612c-92d7-4c03-873a-b2e730c9a72d
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: 84f1ea48887f89cf06ed4b41d0de0dfc24e9d508
ms.sourcegitcommit: 99084d70c032c4db109328a4ca100cd3f5759433
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/20/2020
ms.locfileid: "88697120"
---
# <a name="create-certificate-profiles"></a>创建证书配置文件

适用范围：  Configuration Manager (Current Branch)

使用 Configuration Manager 中的证书配置文件，为受管理设备预配访问公司资源所需的证书。 创建证书配置文件前，请按照 [Set up certificate infrastructure](certificate-infrastructure.md)（设置证书基础结构）中所述的内容设置证书基础结构。  

> [!TIP]
> 对于共同管理的设备，请考虑将[“资源访问策略”工作负载](../../comanage/workloads.md#resource-access-policies)迁移到 Intune  。 然后使用 Intune 策略管理这些证书。 有关详细信息，请参阅[如何切换工作负载](../../comanage/how-to-switch-workloads.md)。

本文介绍如何创建受信任的根和简单证书注册协议 (SCEP) 证书配置文件。 若要创建 PFX 证书配置文件，请参阅 [Create PFX certificate profiles](../../mdm/deploy-use/create-pfx-certificate-profiles.md)（创建 PFX 证书配置文件）。

创建证书配置文件：

1. 启动“创建证书配置文件向导”。
1. 提供有关证书的一般信息。
1. 配置受信任证书颁发机构 (CA) 的证书。  
1. 配置 SCEP 证书信息。  
1. 为证书配置文件指定支持的平台。

## <a name="start-the-wizard"></a>启动向导  

启动“创建证书配置文件”：

1. 在 Configuration Manager 控制台中，转到“资产和符合性”工作区中，依次展开“符合性设置”和“公司资源访问”，然后选择“证书配置文件”节点     。  

1. 在功能区的“主页”选项卡上，选择“创建”组中的“创建证书配置文件”    。  

## <a name="general"></a>常规

在“创建证书配置文件向导”的“常规”  页上，指定下列信息：  

- **名称**：输入证书配置文件的唯一名称。 最多可以使用 256 个字符。  

- **描述**：提供证书配置文件的概述。 还包括有助于在 Configuration Manager 控制台中标识它的其他相关信息。 最多可以使用 256 个字符。  

- 指定想要创建的证书配置文件的类型：

  - **受信任的 CA 证书**：选择此类型以部署受信任的根证书颁发机构 (CA) 或中间 CA 证书以在用户或设备必须验证另一台设备时形成证书信任链。 例如，设备可能是远程身份验证拨入用户服务 (RADIUS) 服务器或虚拟专用网 (VPN) 服务器。
  
    同时配置受信任的 CA 证书配置文件，然后才能创建 SCEP 证书配置文件。 在这种情况下，受信任的 CA 证书必须是向用户或设备颁发证书的 CA。  

  - **简单证书注册协议(SCEP)设置**：选择此类型以通过使用简单证书注册协议和网络设备注册服务 (NDES) 角色服务为用户或设备请求证书。

  - **个人信息交换- PKCS #12 (PFX) 设置 - 导入**：选择此选项以导入 PFX 证书。 有关详细信息，请参阅[导入 PFX 证书配置文件](../../mdm/deploy-use/import-pfx-certificate-profiles.md)。

  - **个人信息交换 PKCS #12 (PFX) 设置 - 创建**：选择此选项以使用证书颁发机构处理 PFX 证书。 有关详细信息，请参阅[创建 PFX 证书配置文件](../../mdm/deploy-use/create-pfx-certificate-profiles.md)。

## <a name="trusted-ca-certificate"></a>受信任的 CA 证书  

> [!IMPORTANT]  
> 在创建 SCEP 证书配置文件之前，你至少必须配置一个受信任的 CA 证书配置文件。
>
> 如果在部署证书后更改这些值中的任何一个值，则需要请求新的证书：
>
> - 密钥存储提供程序
> - 证书模板名称
> - 证书类型
> - 使用者名称格式
> - 使用者可选名称
> - 证书有效期
> - 密钥用法
> - 密钥大小
> - 扩展密钥用法
> - 根 CA 证书

1. 在“创建证书配置文件向导”的“受信任的 CA 证书”  页上，指定下列信息：  

    - **证书文件**：选择“导入”，然后浏览到证书文件  。  

    - **目标存储区**：对于具有多个证书存储区的设备，选择存储证书的位置。 对于仅有一个存储区的设备，则忽略此设置。  

2. 使用“证书指纹”值来验证是否导入了正确的证书  。  

## <a name="scep-certificates"></a>SCEP 证书

### <a name="1-scep-servers"></a>1.SCEP 服务器

在“创建证书配置文件向导”的“SCEP 服务器”  页上，指定将通过 SCEP 颁发证书的 NDES 服务器的 URL。 你可以基于证书注册点的配置自动分配 NDES URL，也可以手动添加 URL。  

### <a name="2-scep-enrollment"></a>2.SCEP 注册

完成“创建证书配置文件向导”的“SCEP 注册”  页。

- **重试**：指定设备向 NDES 服务器自动重试证书请求的次数。 此设置支持 CA 管理程序在证书请求被接受之前必须对其进行批准的方案。 此设置通常用于安全性很高的环境或者你有独立颁发 CA（而不是企业 CA）的情况。 你还可以将此设置用于测试用的，以便能够在颁发 CA 处理证书请求之前检查证书请求选项。 将此设置与“重试延迟(分钟)”  设置一起使用。  

- **重试延迟(分钟)** ：在颁发 CA 处理证书请求之前，指定在使用 CA 管理程序批准时每次注册尝试之间的间隔（以分钟为单位）。 如果出于测试目的使用管理者审批操作，请指定一个较低值。 这样，在批准请求后无需等待较长时间，设备即可再次尝试发送证书请求。

    如果在生产网络上使用管理者审批，请指定较高值。 此行为使 CA 管理员有足够的时间批准或拒绝待决审批。  

- **续订阈值(%)** ：指定设备请求证书续订之前剩余的证书有效期限的百分比。  

- **密钥存储提供程序(KSP)** ：指定存储证书密钥的位置。 可以选择下列值之一：  

  - **如果存在受信任的平台模块 (TPM) 则安装到该处**：将密钥安装到 TPM。 如果 TPM 不存在，则该密钥会安装到软件密钥的存储提供程序。  

  - **安装到受信任的平台模块(TPM)，否则失败**：将密钥安装到 TPM。 如果 TPM 模块不存在，则安装将失败。  

  - **安装到 Windows Hello 企业版，否则失败**：此选项适用于 Windows 10 设备。 它允许你将证书存储在受多重身份验证保护的 Windows Hello 商业版商店中。 有关详细信息，请参阅 [Windows Hello 企业版](/windows/security/identity-protection/hello-for-business/hello-identity-verification)。

    > [!NOTE]  
    > 此选项不支持对“证书属性”页面上的“增强型密钥使用”使用智能卡登录。

  - **安装到软件密钥存储提供程序**：将密钥安装到软件密钥存储提供程序。  

- **用于证书注册的设备**：如果要将证书配置文件部署到用户集合，可以只允许在用户的主设备上注册证书，也可以允许在用户登录的任何设备上注册证书。

    如果将证书配置文件部署到设备集合，则仅为设备的主要用户注册证书，或为登录到该设备的所有用户注册证书。  

### <a name="3-certificate-properties"></a>3.证书属性

在“创建证书配置文件向导”的“证书属性”  页上，指定下列信息：  

- **证书模板名称**：选择在 NDES 中配置并添加到证书颁发机构 (CA) 的证书模板的名称。 若要成功浏览到证书模板，用户帐户需要证书模板的“读取”权限  。 如果无法浏览证书，则键入其名称  。  

  > [!IMPORTANT]
  > 如果证书模板名称包含非 ASCII 字符，则不部署证书。 （这些字符的一个示例来自中文字母表。）若要确保部署证书，请先在 CA 上创建证书模板的副本。 然后使用 ASCII 字符为副本重命名。  

  - 如果你通过浏览来选择证书模板名称，则页面上的某些字段会依据证书模板自动填充  。 在某些情况下，除非选择其他证书模板，否则你无法更改这些值。  

  - 如果键入证书模板的名称，请确保该名称与其中一个证书模板准确匹配  。 它必须与 NDES 服务器注册表中列出的名称匹配。 确保指定证书模板名称，而不是证书模板显示名称。  

    若要查找证书模板的名称，请浏览以下注册表项：`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography\MSCEP`。 其列出作为 EncryptionTemplate、GeneralPurposeTemplate 和 SignatureTemplate 的值的证书模板    。 默认情况下，所有三个证书模板的值为“IPSECIntermediateOffline”  ，映射为模板显示名称“IPSec (脱机请求)”  。  

    > [!WARNING]  
    > 键入证书模板的名称后，Configuration Manager 无法验证证书模板的内容。 选择证书模板不支持的选项或许是可能的，但可能导致证书请求失败。 如果发生这种行为，你将在 CPR.log 文件中看到 w3wp.exe 的错误消息，指出模板名称位于证书签名请求 (CSR) 中，并且质询不匹配。  
    >
    > 如果键入为“GeneralPurposeTemplate”值指定的证书模板的名称，则为此证书配置文件选择“密钥加密”和“数字签名”选项    。 如果要仅在此证书配置文件中启用“密钥加密”选项，请为“EncryptionTemplate”项指定证书模板名称   。 同样，如果要仅在此证书配置文件中启用“数字签名”  选项，请为“SignatureTemplate”  项指定证书模板名称。  

- **证书类型**：选择是将证书部署到设备还是用户。  

- **使用者名称格式**：选择 Configuration Manager 自动创建证书请求中的使用者名称的方式。 如果证书用于用户，还可包含使用者名称中的用户电子邮件地址。

    > [!NOTE]  
    > 如果你选择“IMEI 号码”或“序列号”，则可以区分同一用户拥有的不同设备   。 例如，这些设备可以共享公用名，但不可共享 IMEI 号码或序列号。 如果设备不报告 IMEI 号码或序列号，则使用公用名颁发证书。

- **使用者可选名称**：指定 Configuration Manager 自动创建证书请求中使用者可选名称 (SAN) 的值的方式。 例如，你选择了用户证书类型，则可以在使用者可选名称中包括用户主体名称 (UPN)。 如果要向网络策略服务器验证客户端证书，则将使用者可选名称设置为 UPN。  

- **证书有效期**：如果对发证 CA 设置自定义有效期，请在证书过期前指定剩余时间量。

    > [!TIP]
    > 使用以下命令行设置自定义有效期：`certutil -setreg Policy\EditFlags +EDITF_ATTRIBUTEENDDATE`
    > 有关此命令的详细信息，请参阅[证书基础结构](certificate-infrastructure.md)。  

    你可以指定比指定证书模板中的有效期小的值，但不能指定较大的值。 例如，证书模板中的证书有效期为 2 年，则你可以指定值 1 年，但不能指定值 5 年。 该值还必须小于发证 CA 证书的剩余有效期。  

- **密钥用法**：指定证书的密钥用法选项。 选择从以下选项：  

  - **密钥加密**：仅在密钥已加密时才允许密钥交换。  

  - **数字签名**：仅当数字签名有助于保护密钥时才允许密钥交换。  

  如果浏览了证书模板，则无法更改这些设置，除非选择其他证书模板。  

  使用上述两个关键使用选项中的一个或两个配置所选证书模板。 否则，你将在证书注册点日志文件“Crp.log”看到以下消息：  CSR 和质询中的密钥用法不匹配   

- **密钥大小(位)** ：选择以位为单位的密钥大小。  

- **扩展密钥用法**：为证书的预期目的添加值。 大多数情况下，证书需要“客户端身份验证”以便用户或设备能够向服务器进行验证  。 你可以根据需要添加任何其他密钥用法。  

- **哈希算法**：选择要与此证书一起使用的可用哈希算法类型之一。 选择连接设备支持的最高级别安全性。  

  > [!NOTE]  
  > **SHA-2** 支持 SHA-256、SHA-384 和 SHA-512。 **SHA-3** 仅支持 SHA-3。  

- **根 CA 证书**：选择之前配置并部署到用户或设备的根 CA 证书配置文件。 此 CA 证书必须是将颁发在此证书配置文件中配置的证书的 CA 的根证书。  

  > [!IMPORTANT]  
  > 如果指定未部署到用户或设备的根 CA 证书，Configuration Manager 将不会发起在此证书配置文件中配置的证书请求。  

## <a name="supported-platforms"></a>受支持的平台  

在“创建证书配置文件向导”的“支持的平台”页上，选择将在其中安装证书配置文件的 OS 版本  。 选择“全选”以将证书配置文件安装到所有可用操作系统  。

## <a name="next-steps"></a>后续步骤

新的证书配置文件将显示在“资产和符合性”工作区的“证书配置文件”节点中   。 可将其部署到用户或设备。 有关详细信息，请参阅[如何部署配置文件](deploy-wifi-vpn-email-cert-profiles.md)。