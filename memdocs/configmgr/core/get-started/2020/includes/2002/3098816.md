---
author: mestew
ms.author: mstewart
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: include
ms.date: 02/13/2020
ms.openlocfilehash: 767174ccbb63287ecc595d6e0c47ebc604e8103a
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/21/2020
ms.locfileid: "81693085"
---
## <a name="improvements-to-orchestration-groups"></a><a name="bkmk_orch"></a> 业务流程组的改进
<!--3098816-->
创建一个业务流程组，以便更好地控制设备上软件更新的部署。 业务流程组使你可以灵活地根据百分比、特定数量或显式顺序更新设备。 你还可以在设备运行更新部署之前和之后运行 PowerShell 脚本。

业务流程组是“服务器组”功能的演变。 他们首先在 [Configuration Manager 技术预览版（版本 1909）](../../../2019/technical-preview-1909.md)中引入。 我们在[技术预览版 2001](../../technical-preview-2001.md#bkmk_orch) 和[技术预览版 2001.2](../../technical-preview-2001-2.md#bkmk_orch) 中改进了业务流程组。 在此技术预览版中，我们为业务流程组添加了以下改进：

- 清除业务流程组成员的状态（例如，*“完成”或“失败”），以便可以重新运行业务流程   。
   - 右键单击业务流程组成员，然后选择“重置业务流程组成员”  。
- 为所选成员启动一些基本操作，如“资源浏览器”和“启用详细日志记录”   。
- 需要重新启动的更新现在适用于业务流程。


[![重置业务流程组成员](../../media/3098816-reset-og-member.png)](../../media/3098816-reset-og-member.png#lightbox)


### <a name="try-it-out"></a>试试看！

尝试完成任务。 然后发送[反馈](../../../../understand/find-help.md#product-feedback)，并随附你对该功能的想法。

#### <a name="prerequisites"></a>必备条件

- 若要查看所有业务流程组和这些组的更新，你的帐户必须是“完全权限管理员”  。
- 启用“业务流程组”功能  。 有关详细信息，请参阅[启用可选功能](../../../../servers/manage/install-in-console-updates.md#bkmk_options)。

    > [!NOTE]
    > 启用“业务流程组”时，站点将禁用“服务器组”功能   。 此行为可避免这两种功能之间的任何冲突。

#### <a name="create-an-orchestration-group"></a>创建业务流程组

1. 在 Configuration Manager 控制台中，转到“资产和符合性”工作区，并选择“业务流程组”节点   。

1. 在功能区中，选择“创建业务流程组”，以打开“创建业务流程组向导”   。

1. 在“常规”页上，为业务流程组指定“名称”，并选择性地指定“描述”    。 指定以下各项的值：
   - **业务流程组超时(分钟)** ：所有组成员完成更新安装的时间限制。
   - **业务流程组成员超时(分钟)** ：组中单个设备完成更新安装的时间限制。


1. 在“成员选择”页上，首先指定“站点代码”   。 然后选择“添加”以将设备资源添加为此业务流程组的成员  。 按名称搜索设备，然后添加设备   。 你还可以使用“在集合中搜索”  筛选搜索以包括单个集合。  在完成将设备添加到所选资源列表时，选择“确定”  。
   - 为组选择资源时，仅显示有效的客户端。 进行检查以验证站点代码，验证安装了客户端以及资源不是重复的。

1. 在“规则选择”页上，选择下列选项之一  ：

   - “允许同时更新一定比例的计算机”，然后选择或输入此百分比数字  。 使用此设置，以允许为业务流程组大小提供更大的灵活性。 例如，业务流程组包含 50 个设备，你将此值设置为 10。 在软件更新部署过程中，Configuration Manager 允许五台设备同时运行部署。 如果你稍后将业务流程组的大小增加到 100 台设备，则会同时更新 10 个设备。

   - “允许同时更新多台计算机”，然后选择或输入此特定计数数字  。 无论业务流程组的总体大小是多少，使用此设置可始终限制为特定数量的设备。

   - “指定维护序列”，然后按适当的顺序对所选资源进行排序  。 使用此设置可显式定义设备运行软件更新部署的顺序。

1. 在“PreScript”页上，输入部署运行前要在每个设备上运行的 PowerShell 脚本   。 该脚本应返回值 `0` 表示成功，或返回 `3010` 表示成功并重新启动。 指定“脚本超时(秒)”值，如果在该指定时间内未完成，则脚本将失败  。

1. 在“PostScript”页上，输入部署运行后要在每个设备上运行的 PowerShell 脚本和“脚本超时(秒)”值    。 否则，行为与 PreScript 相同。

1. 完成向导。
1. 可以使用组的“属性”更改现有业务流程组的设置  。 
1. 若要删除该业务流程组，请选择它，然后在功能区中选择“删除”  。

#### <a name="view-orchestration-groups-and-members"></a>查看业务流程组和成员

从“资产和符合性”  工作区中，选择“业务流程组”  节点。 若要查看成员，请选择一个业务流程组，然后在功能区中选择“显示成员”  。 有关节点的可用列的详细信息，请参阅[监视业务流程组和成员](#bkmk_orch_monitor)。


#### <a name="start-orchestration"></a>启动业务流程

- 将[软件更新部署](../../../../../sum/deploy-use/deploy-software-updates.md)到包含业务流程组成员的集合。
   - 当组中的任何客户端尝试在截止时间或在维护时段内安装任何软件更新时，业务流程将启动。 它启动整个组，并确保设备按照业务流程组规则进行更新。
- 可以通过从“业务流程组”  节点中选择业务流程，然后从功能区或右键单击菜单中选择“启动业务流程”  来手动启动业务流程。  

> [!TIP]
> - 业务流程组仅适用于软件更新部署。 它们不适用于其他部署。
> - 可以右键单击业务流程组成员，然后选择“重置业务流程组成员”  。 这使你能够重新运行业务流程。

#### <a name="monitoring"></a><a name="bkmk_orch_monitor"></a>  监视
通过 Configuration Manager 控制台和[日志文件](#log-files)监视业务流程组和成员。

##### <a name="monitor-orchestration-groups"></a>监视业务流程组

从“资产和符合性”  工作区中，选择“业务流程组”  节点。 添加以下任何列以获取有关组的信息：

- **业务流程名称**：业务流程组的名称。
- **站点代码**：组的站点代码。
- **业务流程类型学**：为下列类型之一：
   - 数字
   - 百分比
   - 序列

- **业务流程值**：可以同时获取锁定的成员数或成员百分比。 仅当“业务流程类型”为数字或百分比时，才填充业务流程值     。  
- **业务流程状态**：在业务流程期间为正在进行。 不在进行时为空闲。
- **业务流程开始时间**：业务流程启动的日期和时间。
- **当前序列号**：指示业务流程组的哪个成员处于活动状态。 此数字对应于成员的序列号  。  
- **业务流程超时(分钟)** ：创建或编辑组时在“常规”页上设置的“业务流程组超时(分钟)”的值    。
- **业务流程组成员超时(分钟)** ：创建或编辑组时在“常规”页上设置的“业务流程组成员超时(分钟)”的值    。
- **业务流程组 ID**：组的 ID，ID 在日志和数据库中使用。
- **业务流程组唯一 ID**：组的唯一 ID，唯一 ID 在日志和数据库中使用。

##### <a name="monitor-orchestration-group-members"></a>监视业务流程组成员

在“业务流程组”节点中，选择一个业务流程组  。 在功能区中，选择“显示成员”  。 可以查看组的成员及其业务流程状态。 添加以下任何列以获取有关成员的信息：

- **名称**：业务流程组成员的设备名称
- **当前状态**：提供成员设备的状态。 
   - 在业务流程期间为“正在进行”  。
   - **等待中**：指示客户端正在等待锁定来安装更新。 
   - 当业务流程完成或未运行时为“空闲”  。
- **状态代码**：可以右键单击业务流程组成员，然后选择“重置业务流程组成员”  。 通过重置可以重新运行业务流程。 状态包括： 
   - 闲置
   - 等待，设备正在等待
   - 进行中，正在安装更新
   - Failed
   - 重新启动挂起
- **获取锁定的时间**：由客户端根据其策略请求锁定。 客户端获取锁定后，会在其上触发业务流程。  
-**最后报告状态的时间**：成员最后报告状态的时间。
- **序列号**：队列中客户端安装更新的位置。
- **站点代码**：成员的站点代码。
- **客户端活跃状况**：告知客户端是处于活动状态还是处于非活动状态。
- **主要用户**：哪些用户是设备的主要用户。
- **客户端类型**：客户端的设备类型。
- **当前登录的用户**：哪个用户当前登录到设备。
- **OG ID**：成员所属的业务流程组的 ID。 
- **OG 唯一 ID**：成员所属的业务流程组的唯一 ID。
- **资源 ID**：设备的资源 ID。

#### <a name="log-files"></a>日志文件
使用站点服务器上的以下日志文件来帮助进行监视和故障排除：

##### <a name="site-server"></a>站点服务器
- **Policypv.log**：显示该站点使业务流程组面向客户端。
- **SMS_OrchestrationGroup.log**：显示业务流程组的行为。

##### <a name="client"></a>客户端

- **MaintenanceCoordinator.log**：显示锁定获取、更新安装、前脚本和后脚本以及锁定发布过程。
- **UpdateDeployment.log**：显示更新安装过程。
- **PolicyAgent.log**：检查客户端是否在业务流程组中。 

#### <a name="orchestration-group-known-issues"></a>业务流程组已知问题

- 不要将计算机添加到多个业务流程组。

