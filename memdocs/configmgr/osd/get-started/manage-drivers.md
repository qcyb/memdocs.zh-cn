---
title: 管理驱动程序
titleSuffix: Configuration Manager
description: 使用 Configuration Manager 驱动程序目录导入设备驱动程序、在包中为驱动程序分组，然后这些将包分发到各个分发点。
ms.date: 07/26/2019
ms.prod: configuration-manager
ms.technology: configmgr-osd
ms.topic: how-to
ms.assetid: 84802d55-112e-4f7f-9a48-74a80d91a0f4
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 09cf1b7ee1859043e0839d5a1b5db3518c602b74
ms.sourcegitcommit: d225ccaa67ebee444002571dc8f289624db80d10
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/12/2020
ms.locfileid: "88124425"
---
# <a name="manage-drivers-in-configuration-manager"></a>管理 Configuration Manager 中的驱动程序

适用范围：  Configuration Manager (Current Branch)

Configuration Manager 提供了驱动程序目录，可用于管理 Configuration Manager 环境中的 Windows 设备驱动程序。 使用驱动程序目录将设备驱动程序导入 Configuration Manager、在包中为驱动程序分组，然后这些将包分发到各个分发点。 在目标计算机上安装完整的 OS 时，以及在启动映像中使用 Windows PE 时，可以使用设备驱动程序。 Windows 设备驱动程序由安装信息 (INF) 文件和支持设备所需的任何其他文件组成。 在部署 OS 时，Configuration Manager 将从其 INF 文件中获得设备的硬件和平台信息。 



## <a name="driver-categories"></a><a name="BKMK_DriverCategories"></a>驱动程序类别

在导入设备驱动程序时，可以将设备驱动程序分配到某个类别。 借助设备驱动程序类别，可以在驱动程序目录中将要使用的相似设备驱动程序组合在一起。 例如，将所有网络适配器设备驱动程序设置为特定的类别。 然后，在创建包含[自动应用驱动程序](../understand/task-sequence-steps.md#BKMK_AutoApplyDrivers)步骤的任务序列时，指定设备驱动程序的类别。 Configuration Manager 随后会扫描硬件，从该类别中选择适用的驱动程序以暂存在系统上，以供 Windows 安装程序使用。  



## <a name="driver-packages"></a><a name="BKMK_ManagingDriverPackages"></a> 驱动程序包

在包中对类似的设备驱动程序分组，以帮助简化 OS 部署。 例如，为网络中的每个计算机制造商创建一个驱动程序包。 在将驱动程序直接导入到“驱动程序包”  节点中的驱动程序目录时，可以创建一个驱动程序包。 创建驱动程序包后，将其分发到分发点。 然后 Configuration Manager 客户端计算机可以根据需要安装驱动程序。 

请考虑以下几点：  

- 在创建驱动程序包时，包的源位置必须指向其他驱动程序包并未使用的空网络共享。 SMS 提供程序必须具有对该位置的完全控制权限  。  

- 将设备驱动程序添加到驱动程序包时，Configuration Manager 会将设备驱动程序复制到包的源位置。 只能将已导入的和在驱动程序目录中启用的设备驱动程序添加到驱动程序包。  

- 可以从现有驱动程序包中复制设备驱动程序的子集。 首先，创建新驱动程序包。 然后将设备驱动程序的子集添加到新包，并将新包分发到分发点。  

- 当使用任务序列安装驱动程序时，请创建包含不超过 500 个设备驱动程序的的驱动程序包。


### <a name="create-a-driver-package"></a><a name="BKMK_CreatingDriverPackages"></a> 创建驱动程序包  

> [!IMPORTANT]  
> 若要创建驱动程序包，必须具有一个未由另一个驱动程序包使用的空网络文件夹。 大多数情况下，在开始此过程之前创建新文件夹。  

1. 在 Configuration Manager 控制台中，转到“软件库”工作区  。 展开“操作系统”  ，然后选择“驱动程序包”  节点。  

2. 在功能区“主页”选项卡的“创建”组中，选择“创建驱动程序包”    。  

3. 为驱动程序包指定一个描述性名称  。  

4. 为驱动程序包输入一个可选的注释  。 通过此描述提供有关驱动程序包的内容或用途的信息。  

5. 在“路径”  框中，指定驱动程序包的空源文件夹。 每个驱动程序包必须使用唯一的文件夹。 必须将此路径用作网络位置。  

   > [!IMPORTANT]  
   > 站点服务器帐户必须具有对指定源文件夹的完全控制  权限。  

新驱动程序包不包含任何驱动程序。 下一步是向包中添加驱动程序。  

如果“驱动程序包”  节点包含若干包，你可以向节点中添加文件夹将包分隔为逻辑组。  


### <a name="additional-actions-for-driver-packages"></a><a name="BKMK_PackageActions"></a> 驱动程序包的其他操作  

如果从“驱动程序包”  节点中选择一个或多个驱动程序包，则可以执行其他操作来管理驱动程序包。 


#### <a name="create-prestage-content-file"></a>创建预留内容文件
创建可用于手动导入内容及其关联元数据的文件。 如果站点服务器和存储驱动程序包的分发点之间的网络带宽较低，请使用预留内容。

#### <a name="delete"></a>删除
从“驱动程序包”  节点中删除驱动程序包。

#### <a name="distribute-content"></a>分发内容
将驱动程序包分发到与分发点、分发点组以及与集合关联的分发点组。

#### <a name="manage-access-accounts"></a>管理访问帐户
添加、修改或删除驱动程序包的访问帐户。

有关包访问帐户的详细信息，请参阅 [Configuration Manager 中使用的帐户](../../core/plan-design/hierarchy/accounts.md)。

#### <a name="move"></a>移动
将驱动程序包移动到“驱动程序包”  节点中的另一个文件夹。

#### <a name="update-distribution-points"></a>更新分发点
更新存储包的所有分发点上的设备驱动程序包。 此操作只会复制在上次分发点之后已更改的内容。

#### <a name="properties"></a>属性
打开“属性”  对话框。 查看并更改驱动程序的内容和属性。 例如，更改驱动程序的名称和说明，启用或禁用它，并指定它可以运行的平台。 

<!--3607716, fka 1358270-->
从版本 1810 开始，驱动程序包具有用于“制造商”和“模型”的元数据字段   。 使用这些字段可标记驱动程序包的信息，以帮助进行常规任务管理，或标识可以删除的旧的及重复的驱动程序。 在“常规”  选项卡上，从下拉列表中选择现有值，或输入一个字符串来创建新的条目。

在“驱动程序包”  节点中，这些字段在列表中显示为“驱动程序制造商”和   “驱动程序模型”列。 此外，它们还可以用作搜索条件。

从版本 1906 开始，可使用这些特性在客户端上预缓存内容。 有关详细信息，请参阅[配置预缓存内容](../deploy-use/configure-precache-content.md)。<!--4224642-->  




## <a name="device-drivers"></a><a name="BKMK_DeviceDrivers"></a> 设备驱动程序

可以在目标计算机上安装驱动程序，而不将它们包含在部署的 OS 映像中。 Configuration Manager 提供包含对导入 Configuration Manager 的所有驱动程序的引用的驱动程序目录。 此驱动程序目录位于“软件库”工作区中并且包含以下两个节点  ：“驱动程序”和“驱动程序包”   。 “驱动程序”  节点列出了已导入到驱动程序目录的所有驱动程序。  


### <a name="import-device-drivers-into-the-driver-catalog"></a><a name="BKMK_ImportDrivers"></a> 将设备驱动程序导入驱动程序目录  

在将驱动程序用于 OS 的部署过程之前，请将其导入驱动程序目录。 为更便于管理，请仅导入计划在 OS 部署中安装的驱动程序。 在目录中存储驱动程序的多个版本后，可在网络上的硬件设备要求发生更改时轻松升级现有驱动程序。  

作为设备驱动程序导入过程的一部分，Configuration Manager 将读取有关驱动程序的以下属性：
- Provider
- 实例
- 版本
- 签名
- 支持的硬件
- 支持的平台信息

默认情况下，驱动程序按照它支持的第一个硬件设备命名。 可以稍后重命名设备驱动程序。 支持的平台列表以驱动程序的 INF 文件中的信息为基础。 由于此信息的准确性可能有所不同，因此请在将支持的驱动程序导入目录后对其进行手动验证。  

在将设备驱动程序导入目录后，可以将它们添加到驱动程序包或启动映像包。  

> [!IMPORTANT]  
> 无法将设备驱动程序直接导入“驱动程序”  节点的子文件夹。 要将设备驱动程序导入子文件夹，请首先将设备驱动程序导入“驱动程序”  节点，然后将驱动程序移动到该子文件夹。  


#### <a name="process-to-import-windows-device-drivers-into-the-driver-catalog"></a>将 Windows 设备驱动程序导入驱动程序目录的过程  

1. 在 Configuration Manager 控制台中，转到“软件库”工作区  。 展开“操作系统”  ，选择“驱动程序”  节点。  

2. 在功能区“主页”  选项卡上的“创建”  组中，选择“导入驱动程序”  以启动“导入新的驱动程序向导”  。  

3. 在“定位驱动程序”  页上，指定以下选项：  

    - **导入下列网络路径(UNC)中的所有驱动程序**：若要导入特定文件夹中的所有设备驱动程序，请指定其网络路径。 例如： `\\servername\share\folder`。  

        > [!NOTE]  
        > 如果有很多子文件夹和很多驱动程序 INF 文件，此过程可能需要一些时间。  

    - **导入特定驱动程序**：要导入文件夹中的特定驱动程序，请指定 Windows 设备驱动程序 INF 的网络路径。  

    - **针对重复驱动程序指定选项**：选择在导入重复的设备驱动程序时，希望 Configuration Manager 如何管理驱动程序类别  
        - **导入驱动程序并将新类别附加到现有类别**  
        - **导入驱动程序并保留现有类别**  
        - **导入驱动程序并覆盖现有类别**  
        - **不导入驱动程序**  

    > [!IMPORTANT]  
    > 在导入驱动程序时，站点服务器必须具有对该文件夹的“读取”  权限，否则导入将失败。  

4. 在“驱动程序详细信息”  页上，指定以下选项：  

    - **(对于启动映像)隐藏不属于存储或网络类的驱动程序**：使用此设置仅显示存储和网络驱动程序。 此选项会隐藏启动映像通常不需要的其他驱动程序，如视频驱动程序或调制解调器驱动程序。  

    - **隐藏未进行数字签名的驱动程序**：Microsoft 建议仅使用数字签名的驱动程序  

    - 在驱动程序列表中，选择要导入驱动程序目录的驱动程序。  

    - **启用这些驱动程序并允许计算机安装**：选择此设置以让计算机安装设备驱动程序。 默认情况下会启用此选项。  

        > [!IMPORTANT]  
        > 如果设备驱动程序会导致问题或你要暂停设备驱动程序的安装，请在导入期间将其禁用。 也可以在导入驱动程序后将其禁用。  

    - 若要将设备驱动程序分配到管理类别（例如“台式机”或“笔记本”类别）以供筛选之用，请选择“类别”  。 然后选择现有类别或创建新类别。 使用类别来控制[自动应用驱动程序](../understand/task-sequence-steps.md#BKMK_AutoApplyDrivers)任务序列步骤应用的设备驱动程序。  

5. 在“将驱动程序添加到包”  页上，选择是否要将驱动程序添加到包。  

    - 选择用于分发设备驱动程序的驱动程序包。  

        如有必要，可选择“新建包”  创建新的驱动程序包。 在创建新的驱动程序包时，提供未由其他驱动程序包使用的网络共享。  

    - 如果已将包分发到分发点，请选中对话框中的“是”  以更新分发点上的启动映像。 在将设备驱动程序分发到分发点之前，将无法使用这些驱动程序。 如果选中“否”  ，则先运行“更新分发点”  操作，然后再使用启动映像。 如果从未分发驱动程序包，则必须使用“驱动程序包”节点中的“分发内容”操作   。  

6. 在“将驱动程序添加到启动映像”  页上，选择是否将设备驱动程序添加到现有的启动映像。  

    > [!NOTE]  
    > 仅将存储和网络驱动程序添加到启动映像。  

    - 在对话框中选择“是”  以更新分发点上的启动映像。 在将设备驱动程序分发到分发点之前，将无法使用这些驱动程序。 如果选中“否”  ，则先运行“更新分发点”  操作，然后再使用启动映像。 如果从未分发驱动程序包，则必须使用“驱动程序包”节点中的“分发内容”操作   。  

    - 如果一个或多个驱动程序的体系结构与所选的启动映像的体系结构不匹配，Configuration Manager 会发出警告。 如果不匹配，请选择“确定”  。 返回到“驱动程序详细信息”  页，取消选中与所选启动映像的体系结构不匹配的驱动程序。 例如，如果选择 x64 和 x86 启动映像，则所有驱动程序必须支持这两种体系结构。 如果选择 x64 启动映像，则所有驱动程序必须支持 x64 体系结构。  

        > [!NOTE]  
        > - 该体系结构以制造商提供的 .INF 中所报告的体系结构为基础。  
        > - 如果驱动程序报告称它支持两种体系结构，则可以将其导入到任一启动映像。  

    - 如果将非网络或存储驱动程序的设备驱动程序添加到启动映像，Configuration Manager 会发出警告。 在大多数情况下，启动映像不需要这些驱动程序。 选择“是”  将驱动程序添加到启动映像，或选择“否”  返回并修改驱动程序选择。  

    - 如果一个或多个选定的驱动程序未正确进行数字签名，则 Configuration Manager 会发出警告。 选择“是”  继续，选择“否”  返回并更改驱动程序选择。  

7. 完成向导。  


### <a name="manage-device-drivers-in-a-driver-package"></a><a name="BKMK_ModifyDriverPackage"></a> 管理驱动程序包中的设备驱动程序  

使用下列过程来修改驱动程序包和启动映像。 若要添加或删除驱动程序，首先在“驱动程序”  节点中找到它。 然后编辑与所选驱动程序关联的包或启动映像。  

1. 在 Configuration Manager 控制台中，转到“软件库”工作区  。 展开“操作系统”  ，然后选择“驱动程序”  节点。  

2. 选择要添加到驱动程序包的设备驱动程序。  

3. 在功能区“主页”  选项卡的“驱动程序”  组中，选择“编辑”  ，然后选择“驱动程序包”  。  

4. 要添加设备驱动程序，请选中要向其中添加设备驱动程序的驱动程序包的复选框。 要删除设备驱动程序，请清除要从中删除设备驱动程序的驱动程序包的复选框。  

    如果要添加与驱动程序包关联的设备驱动程序，可以选择创建新包。 选择“新建包”  ，这将打开“新建驱动程序包”  对话框。  

5. 如果已将包分发到分发点，请选中对话框中的“是”  以更新分发点上的启动映像。 在将设备驱动程序分发到分发点之前，将无法使用这些驱动程序。 如果选中“否”  ，则先运行“更新分发点”  操作，然后再使用启动映像。 如果从未分发驱动程序包，则必须使用“驱动程序包”节点中的“分发内容”操作   。 必须在分发点上更新驱动程序包，才能使用其中的驱动程序。  

    完成后，选择“确定”  。  


### <a name="manage-device-drivers-in-a-boot-image"></a><a name="BKMK_ManageDriversBootImage"></a> 管理启动映像中的设备驱动程序  

可以添加到已导入到目录的启动映像 Windows 设备驱动程序。 在将设备驱动程序添加到启动映像时，请使用以下准则：  

- 仅将存储和网络驱动程序添加到启动映像。 Windows PE 中通常不需要其他类型的驱动程序。 不需要的驱动程序会不必要地增加启动映像的大小。  

- 仅将适用于 Windows 10 的设备驱动程序添加到启动映像。 Windows PE 所需的版本基于 Windows 10 来确定。  

- 请务必使用与启动映像的体系结构相符的正确设备驱动程序。 请勿将 x86 设备驱动程序添加到 x64 启动映像。  

#### <a name="process-to-modify-the-device-drivers-associated-with-a-boot-image"></a>修改与启动映像关联的设备驱动程序的过程  

1. 在 Configuration Manager 控制台中，转到“软件库”工作区  。 展开“操作系统”  ，然后选择“驱动程序”  节点。  

2. 选择要添加到驱动程序包的设备驱动程序。  

3. 在功能区“主页”  选项卡的“驱动程序”  组中，选择“编辑”  ，然后选择“启动映像”  。  

4. 要添加设备驱动程序，请选中要向其中添加设备驱动程序的启动映像的复选框。 要删除设备驱动程序，请清除要从中删除设备驱动程序的启动映像的复选框。  

5. 如果不希望更新存储启动映像的分发点，请取消选中“完成后更新分发点”  复选框。 默认情况下，会在更新启动映像后更新分发点。  

    - 在对话框中选择“是”  以更新分发点上的启动映像。 在将设备驱动程序分发到分发点之前，将无法使用这些驱动程序。 如果选中“否”  ，则先运行“更新分发点”  操作，然后再使用启动映像。 如果从未分发驱动程序包，则必须使用“驱动程序包”节点中的“分发内容”操作   。  

    - 如果一个或多个驱动程序的体系结构与所选的启动映像的体系结构不匹配，Configuration Manager 会发出警告。 如果不匹配，请选择“确定”  。 返回到“驱动程序详细信息”  页，取消选中与所选启动映像的体系结构不匹配的驱动程序。 例如，如果选择 x64 和 x86 启动映像，则所有驱动程序必须支持这两种体系结构。 如果选择 x64 启动映像，则所有驱动程序必须支持 x64 体系结构。  

        > [!NOTE]
        > - 该体系结构以制造商提供的 .INF 中所报告的体系结构为基础。  
        > - 如果驱动程序报告称它支持两种体系结构，则可以将其导入到任一启动映像。  

    - 如果将非网络或存储驱动程序的设备驱动程序添加到启动映像，Configuration Manager 会发出警告。 在大多数情况下，启动映像不需要这些驱动程序。 选择“是”  将驱动程序添加到启动映像，或选择“否”  返回并修改驱动程序选择。  

    - 如果一个或多个选定的驱动程序未正确进行数字签名，则 Configuration Manager 会发出警告。 选择“是”  继续，或者选择“否”  返回并更改驱动程序选择。  


### <a name="additional-actions-for-device-drivers"></a><a name="BKMK_DriverActions"></a> 设备驱动程序的其他操作  

在“驱动程序”  节点中选择驱动程序时，可以执行其他操作来管理驱动程序。  

#### <a name="categorize"></a>分类
清除、管理所选驱动程序或为其设置管理类别。

#### <a name="delete"></a>删除
从“驱动程序”  节点中删除驱动程序，也可以从关联的分发点中删除驱动程序。

#### <a name="disable"></a>禁用
禁止安装驱动程序。 此操作可临时禁用驱动程序。 在部署 OS 时，任务序列无法安装已禁用的驱动程序。 

> [!Note]  
> 此操作只会阻止驱动程序使用“自动应用驱动程序”  任务序列步骤进行安装。

#### <a name="enable"></a>启用
在部署 OS 时，让 Configuration Manager 客户端计算机和任务序列安装设备驱动程序。

#### <a name="move"></a>移动
将设备驱动程序移动到“驱动程序”  节点中的另一个文件夹。

#### <a name="properties"></a>属性
打开“属性”  对话框。 查看并更改驱动程序的属性。 例如，更改驱动程序的名称和说明，启用或禁用它，并指定它可以运行的平台。



## <a name="use-task-sequences-to-install-drivers"></a><a name="BKMK_TSDrivers"></a>使用任务序列安装驱动程序  

任务序列可用于自动执行部署 OS 的过程。 任务序列中的每个步骤都能执行特定的操作，例如安装驱动程序。 在部署 OS 时，可以使用以下两个任务序列步骤来安装设备驱动程序：  

- [自动应用驱动程序](../understand/task-sequence-steps.md#BKMK_AutoApplyDrivers)：此步骤能让你自动匹配和安装作为操作系统部署一部分的设备驱动程序。 可以配置任务序列步骤，以便为检测到的每个硬件设备仅安装最匹配的驱动程序。 或者，指定步骤为检测到的每个硬件设备安装所有兼容的驱动程序，并允许 Windows 安装程序选择最适合的驱动程序。 此外，还可以指定驱动程序类别，以限制可用于此步骤的驱动程序。  

- [应用驱动程序包](../understand/task-sequence-steps.md#BKMK_ApplyDriverPackage)：此步骤能让你将特定的驱动程序包中的所有设备驱动程序都提供给 Windows 安装程序使用。 在指定的驱动程序包中，Windows 安装程序会搜索所需的设备驱动程序。 创建独立媒体时，必须使用此步骤安装设备驱动程序。  

在使用这两个任务序列步骤时，还可以指定如何在部署 OS 的计算机上安装驱动程序。 有关详细信息，请参阅[管理任务序列以自动执行任务](../deploy-use/manage-task-sequences-to-automate-tasks.md)。  



## <a name="driver-reports"></a><a name="BKMK_DriverReports"></a>驱动程序报表  

通过使用“驱动程序管理”  报表类别中的几个报表，可以确定有关驱动程序目录中的设备驱动程序的常规信息。 有关报表的详细信息，请参阅[报表简介](../../core/servers/manage/introduction-to-reporting.md)。

