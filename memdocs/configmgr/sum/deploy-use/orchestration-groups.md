---
title: 业务流程组
titleSuffix: Configuration Manager
description: 创建业务流程组并向其部署更新。
ms.date: 04/28/2020
ms.prod: configuration-manager
ms.technology: configmgr-sum
ms.topic: conceptual
ms.assetid: cddbebea-b418-4839-b0a8-7809486c8a4c
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: e9a307df23900abb985535b2ab59a5ff172cafb7
ms.sourcegitcommit: 0e62655fef7afa7b034ac11d5f31a2a48bf758cb
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/29/2020
ms.locfileid: "82254905"
---
# <a name="orchestration-groups-in-configuration-manager"></a>Configuration Manager 中的业务流程组
<!--3098816-->
适用范围：  Configuration Manager (Current Branch)

从 Configuration Manager 版本 2002 开始，可以创建业务流程组。 创建一个业务流程组，以便更好地控制设备上软件更新的部署。 许多服务器管理员需要认真管理特定工作负载的更新，并在这些工作负载之间实现行为自动化。

业务流程组使你可以灵活地根据百分比、特定数量或显式顺序更新设备。 你还可以在设备运行更新部署之前和之后运行 PowerShell 脚本。

业务流程组的成员可以是任何 Configuration Manager 客户端，而不仅仅是服务器。 业务流程组规则适用于所有软件更新部署到包含业务流程组成员的任何集合的设备。 其他部署行为仍适用。 例如，维护时段和部署计划。

> [!NOTE]
> 在该 Configuration Manager 版本中，业务流程组是一项预发行功能。 若要启用此功能，请参阅[预发行功能](../../core/servers/manage/pre-release-features.md)。  
>
> “业务流程组”功能是[服务器组](service-a-server-group.md)功能的演变  。 业务流程组是 Configuration Manager 中的对象。

## <a name="orchestration-group-usage-example"></a>业务流程组用法示例

- 作为软件更新管理员，你可以管理组织的所有更新。
- 所有服务器对应一个大型集合，所有客户端对应一个大型集合。 将所有更新部署到这些集合。
- SQL 管理员想要控制 SQL Server 上安装的所有软件。 他们希望按特定顺序为五台服务器安装修补程序。 当前流程是在安装更新前手动停止特定服务，然后重启服务。
- 创建一个业务流程组，并添加所有五个 SQL Server。 你还可以使用 SQL 管理员提供的 PowerShell 脚本来添加备份前脚本和备份后脚本。
- 在下一个更新周期内，你可以像在大型服务器集合中一样，创建和部署软件更新。 SQL 管理员运行部署，而业务流程组则自动执行订单和服务。

## <a name="prerequisites"></a>必备条件

### <a name="site-server-and-permission-prerequisites"></a>站点服务器和权限先决条件
- 若要查看所有业务流程组和这些组的更新，你的帐户必须是“完全权限管理员”  。
   - 当前不支持对业务流程组进行基于角色的管理。
- 启用“业务流程组”功能  。 有关详细信息，请参阅[启用可选功能](../../core/servers/manage/install-in-console-updates.md#bkmk_options)。
   - 启用“业务流程组”时，站点将禁用“服务器组”功能   。 此行为可避免这两种功能之间的任何冲突。

### <a name="client-prerequisites"></a>客户端先决条件

- 将目标设备升级到 Configuration Manager 客户端的最新版本。
- 业务流程组的成员应分配到同一站点。
- 设备不能在多个业务流程组中。
   - 添加新成员时，无法选择业务流程组中已有的设备。


## <a name="limitations"></a>限制

- 最多可以有 1000 个业务流程组成员。
- 业务流程组不能在互操作模式下工作。 有关详细信息，请参阅 [Configuration Manager 不同版本之间的互操作性](../../core/plan-design/hierarchy/interoperability-between-different-versions.md#bkmk_mixed)。 <!--6389000-->
- 如果更新是由用户从软件中心启动的，则将绕过业务流程。 <!--6362887-->

## <a name="server-groups-are-automatically-updated-to-orchestration-groups"></a>服务器组自动更新为业务流程组

“业务流程组”功能是[服务器组](service-a-server-group.md)功能的演变  。 安装 Configuration Manager 版本 2002 或更高版本并启用服务器组时，服务器组会自动更新为业务流程组。

## <a name="create-an-orchestration-group"></a>创建业务流程组

1. 在 Configuration Manager 控制台中，转到“资产和符合性”工作区，并选择“业务流程组”节点   。

1. 在功能区中，选择“创建业务流程组”，以打开“创建业务流程组向导”   。

1. 在“常规”页上，为业务流程组指定“名称”，并选择性地指定“描述”    。 指定以下各项的值：
   - **业务流程组超时(分钟)** ：所有组成员完成更新安装的时间限制。
   - **业务流程组成员超时(分钟)** ：组中单个设备完成更新安装的时间限制。

1. 在“成员选择”页上，首先指定“站点代码”   。 然后选择“添加”以将设备资源添加为此业务流程组的成员  。 按名称搜索设备，然后添加设备   。 你还可以使用“在集合中搜索”  筛选搜索以包括单个集合。  在完成将设备添加到所选资源列表时，选择“确定”  。
   - 为组选择资源时，仅显示有效的客户端。 进行检查以验证站点代码，确保安装了客户端并且资源不是重复的。

1. 在“规则选择”页上，选择下列选项之一  ：

   - “允许同时更新一定比例的计算机”，然后选择或输入此百分比数字  。 使用此设置，以允许为业务流程组大小提供更大的灵活性。 例如，业务流程组包含 50 个设备，你将此值设置为 10。 在软件更新部署过程中，Configuration Manager 允许五台设备同时运行部署。 如果你稍后将业务流程组的大小增加到 100 台设备，则会同时更新 10 个设备。

   - “允许同时更新多台计算机”，然后选择或输入此特定计数数字  。 无论业务流程组的总体大小是多少，使用此设置可始终限制为特定数量的设备。

   - “指定维护序列”，然后按适当的顺序对所选资源进行排序  。 使用此设置可显式定义设备运行软件更新部署的顺序。

1. 在“备份前脚本”页上，输入部署运行*前*要在每个设备上运行的 PowerShell 脚本  。 该脚本应返回值 `0` 表示成功，或返回 `3010` 表示成功并重新启动。

1. 在“备份后脚本”页上，输入部署运行*后*要在每个设备上运行的 PowerShell 脚本  。 否则，行为与 PreScript 相同。

1. 完成向导。

> [!WARNING]
> 在将备份前脚本和备份后脚本用于业务流程组之前，请确保对其进行测试。 备份前脚本和备份后脚本不会超时，并且将一直运行到业务流程组成员超时为止。

## <a name="view-orchestration-groups-and-members"></a>查看业务流程组和成员

从“资产和符合性”  工作区中，选择“业务流程组”  节点。 若要查看成员，请选择一个业务流程组，然后在功能区中选择“显示成员”  。 有关节点的可用列的详细信息，请参阅[监视业务流程组和成员](#bkmk_orch_monitor)。

## <a name="edit-or-delete-an-orchestration-group"></a>编辑或删除业务流程组

若要删除业务流程组，请选择它，然后在功能区中或从右键单击菜单中单击“删除”  。 若要编辑业务流程组，请选择它，然后在功能区中或从右键单击菜单中单击“属性”  。 更改以下选项卡中的设置：

   - 常规  ： 
      - **名称**：业务流程组的名称
      - **描述**：业务流程组描述（可选）
      - **业务流程组超时(分钟)** ：所有组成员完成更新安装的时间限制。
      - **业务流程组成员超时(分钟)** ：组中单个设备完成更新安装的时间限制。

  - **成员选择**：
     - **站点代码**：业务流程组的站点代码。
     - **成员**：单击“添加”可为业务流程组选择附加设备  。 单击“删除”可删除所选设备  。

   - **规则选择**：
      - “允许同时更新一定比例的计算机”，然后选择或输入此百分比数字  。 使用此设置，以允许为业务流程组大小提供更大的灵活性。 例如，业务流程组包含 50 个设备，你将此值设置为 10。 在软件更新部署过程中，Configuration Manager 允许五台设备同时运行部署。 如果你稍后将业务流程组的大小增加到 100 台设备，则会同时更新 10 个设备。
      - “允许同时更新多台计算机”，然后选择或输入此特定计数数字  。 无论业务流程组的总体大小是多少，使用此设置可始终限制为特定数量的设备。
      - **指定维护日程安排**：按正确的顺序对所选资源进行排序。 使用此设置可显式定义设备运行软件更新部署的顺序。

   - **备份前脚本**： 
       - 输入部署运行*前*要在每个设备上运行的 PowerShell 脚本。 该脚本应返回值 `0` 表示成功，或返回 `3010` 表示成功并重新启动。
       
   - **备份后脚本**：
      - 输入部署运行*后*要在每个设备上运行的 PowerShell 脚本。 该脚本应返回值 `0` 表示成功，或返回 `3010` 表示成功并重新启动。
   > [!WARNING]
   > 在将备份前脚本和备份后脚本用于业务流程组之前，请确保对其进行测试。 备份前脚本和备份后脚本不会超时，并且将一直运行到业务流程组成员超时为止。


## <a name="start-orchestration"></a>启动业务流程

1. 将[软件更新部署](deploy-software-updates.md)到包含业务流程组成员的集合。

1. 当组中的任何客户端尝试在截止时间或在维护时段内安装任何软件更新时，业务流程将启动。 它启动整个组，并确保设备按照业务流程组规则进行更新。
1. 可以通过从“业务流程组”  节点中选择业务流程，然后从功能区或右键单击菜单中选择“启动业务流程”  来手动启动业务流程。
1. 如果业务流程组处于“失败”状态  ：
   1. 确定业务流程失败的原因并解决所有问题。
   1. [重置组成员的业务流程状态](#bkmk_reset)。
   1. 从“业务流程组”节点中，单击“启动业务流程”按钮来重新开始业务流程   。
   [![启动业务流程](./media/3098816-start-orchestration.png)](./media/3098816-start-orchestration.png#lightbox)


> [!TIP]
> - 业务流程组仅适用于软件更新部署。 它们不适用于其他部署。
> - 可以右键单击业务流程组成员，然后选择“重置业务流程组成员”  。 这使你能够重新运行业务流程。


## <a name="monitor-orchestration-groups"></a><a name="bkmk_orch_monitor"></a> 监视业务流程组

从“资产和符合性”  工作区中，选择“业务流程组”  节点。 添加以下任何列以获取有关组的信息：

- **业务流程名称**：业务流程组的名称。
- **站点代码**：组的站点代码。
- **业务流程类型学**：为下列类型之一：
   - 数字
   - 百分比
   - 序列

- **业务流程值**：可以同时获取锁定的成员数或成员百分比。 仅当“业务流程类型”为数字或百分比时，才填充业务流程值     。  
- **业务流程状态**：在业务流程期间为正在进行。 不在进行时为空闲。
- **业务流程开始时间**：业务流程启动的日期和时间。
- **当前序列号**：指示业务流程组的哪个成员处于活动状态。 此数字对应于成员的序列号  。  
- **业务流程超时(分钟)** ：创建或编辑组时在“常规”页上设置的“业务流程组超时(分钟)”的值    。
- **业务流程组成员超时(分钟)** ：创建或编辑组时在“常规”页上设置的“业务流程组成员超时(分钟)”的值    。
- **业务流程组 ID**：组的 ID，ID 在日志和数据库中使用。
- **业务流程组唯一 ID**：组的唯一 ID，唯一 ID 在日志和数据库中使用。

## <a name="monitor-orchestration-group-members"></a>监视业务流程组成员

在“业务流程组”节点中，选择一个业务流程组  。 在功能区中，选择“显示成员”  。 可以查看组的成员及其业务流程状态。 添加以下任何列以获取有关成员的信息：

- **名称**：业务流程组成员的设备名称
- **当前状态**：提供成员设备的状态。
   - 在业务流程期间为“正在进行”  。
   - **等待中**：指示客户端正在等待锁定来安装更新。
   - 当业务流程完成或未运行时为“空闲”  。
- **状态代码**：可以右键单击业务流程组成员，然后选择“重置业务流程组成员”  。 通过重置可以重新运行业务流程。 状态包括： 
   - 闲置
   - 等待，设备正在等待
   - 进行中，正在安装更新
   - Failed
   - 重新启动挂起
- **获取锁定的时间**：由客户端根据其策略请求锁定。 客户端获取锁定后，会在其上触发业务流程。  
-**最后报告状态的时间**：成员最后报告状态的时间。
- **序列号**：队列中客户端安装更新的位置。
- **站点代码**：成员的站点代码。
- **客户端活跃状况**：告知客户端是处于活动状态还是处于非活动状态。
- **主要用户**：哪些用户是设备的主要用户。
- **客户端类型**：客户端的设备类型。
- **当前登录的用户**：哪个用户当前登录到设备。
- **OG ID**：成员所属的业务流程组的 ID。
- **OG 唯一 ID**：成员所属的业务流程组的唯一 ID。
- **资源 ID**：设备的资源 ID。

## <a name="reset-the-orchestration-state-for-a-group-member"></a><a name="bkmk_reset"></a> 重置组成员的业务流程状态

如果要对组成员重新运行业务流程，可以清除其状态，例如“完成”或“失败”   。 若要清除状态，请右键单击业务流程组成员，然后选择“重置业务流程组成员”  。 也可以从功能区中单击“重置业务流程组成员”  。 重置状态之前，应检查客户端以查看失败原因并更正发现的所有问题。
   [![重置业务流程组成员](./media/3098816-reset-group-member.png)](./media/3098816-reset-group-member.png#lightbox)

## <a name="log-files"></a>日志文件

使用站点服务器上的以下日志文件来帮助进行监视和故障排除：

### <a name="site-server"></a>站点服务器

- **Policypv.log**：显示该站点使业务流程组面向客户端。
- **SMS_OrchestrationGroup.log**：显示业务流程组的行为。

### <a name="client"></a>客户端

- **MaintenanceCoordinator.log**：显示锁获取、更新安装、备份前脚本和备份后脚本以及锁释放过程。
- **UpdateDeployment.log**：显示更新安装过程。
- **PolicyAgent.log**：检查客户端是否在业务流程组中。

## <a name="next-steps"></a>后续步骤

[部署软件更新](deploy-software-updates.md)