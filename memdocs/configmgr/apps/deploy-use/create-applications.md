---
title: 创建应用程序
titleSuffix: Configuration Manager
description: 使用部署类型、检测方法和安装软件要求创建应用程序。
ms.date: 04/01/2020
ms.prod: configuration-manager
ms.technology: configmgr-app
ms.topic: conceptual
ms.assetid: cc230ff4-7056-4339-a0a6-6a44cdbb2857
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 92fb7b2a14815c84d60ed81c33f3b2d8209d2ff6
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/21/2020
ms.locfileid: "81689745"
---
# <a name="create-applications-in-configuration-manager"></a>在 Configuration Manager 中创建应用程序

适用范围：  Configuration Manager (Current Branch)

Configuration Manager 应用程序可定义有关应用程序的元数据。 应用程序具有一个或多个部署类型。 这些部署类型包括安装文件和在设备上安装软件所需的信息。 部署类型还有规则（如检测方法）和要求。 这些规则指定客户端安装软件的时间和方式。  

使用下列方法创建应用程序：  

- 通过读取应用程序安装文件自动创建应用程序和部署类型：  
  - [创建应用程序](#bkmk_create)并[自动检测](#bkmk_auto-app)应用程序信息
  - [创建部署类型](#bkmk_create-dt)并[自动识别](#bkmk_auto-dt)部署类型信息

- 手动创建应用程序并稍后添加部署类型：  
  - [创建应用程序](#bkmk_create)并[手动指定](#bkmk_manual-app)应用程序信息
  - [创建部署类型](#bkmk_create-dt)并[手动指定](#bkmk_manual-dt)部署类型信息

- 从文件[导入应用程序](#bkmk_import)  

本文还包含以下用于配置部署类型的信息：  

- [内容](#bkmk_dt-content)
- [任务序列](#bkmk_dt-ts)
- [检测方法](#bkmk_dt-detect)
- [用户体验](#bkmk_dt-ux)
- [惠?](#bkmk_dt-require)
- [返回代码](#bkmk_dt-return)
- [依赖关系](#bkmk_dt-depend)

## <a name="create-an-application"></a><a name="bkmk_create"></a> 创建应用程序  

1. 在 Configuration Manager 控制台中，转到“软件库”工作区，展开“应用程序管理”，然后选择“应用程序”节点    。  

2. 在功能区的“主页”选项卡上的“创建”组中，选择“创建应用程序”    。  

接下来，自动检测或手动指定应用程序信息：  

- [自动检测](#bkmk_auto-app)应用程序信息可创建具有单一部署类型的基本应用程序。 例如，没有依赖项或要求的 Windows Installer 文件。 使用此过程创建应用程序后，根据需要进行编辑。 可以添加或更改部署类型，还可添加检测方法、依赖关系或要求。  

- [手动指定](#bkmk_manual-app)应用程序信息可创建更复杂的应用程序。 定义多个部署类型、依赖关系、检测方法或要求。  

### <a name="automatically-detect-application-information"></a><a name="bkmk_auto-app"></a> 自动检测应用程序信息  

1. 在“创建应用程序向导”的“常规”  页上，选择“自动检测安装文件中有关此应用程序的信息”  。  

2. 在“类型”  下拉列表中，选择要用于检测应用程序信息的应用程序安装文件类型。 有关可用安装类型的详细信息，请参阅 [Configuration Manager 支持的部署类型](create-applications.md#bkmk_deploy-types)。  

3. 在“位置”框中，指定要用于检测应用程序信息的应用程序安装文件  。 此位置是网络路径 (`\\server\share\filename`) 或应用商店链接。 对于网络路径以及包含应用程序内容的任何子文件夹，用户必须具有访问权限。  

    > [!IMPORTANT]  
    > 如果选择“Windows Installer (\*.msi 文件)”作为应用程序类型，则站点导入指定文件夹中的所有文件  。 然后将这些文件发送到分发点。 请确保指定的文件夹中只有安装应用程序所必需的文件。 经 Microsoft 测试，Configuration Manager 可支持应用程序包中多达 20,000 个文件。 如果应用程序具有更多文件，请考虑创建具有较少文件的多个应用程序。  

4. 在“创建应用程序向导”的“导入信息”页上，查看信息，然后选择“下一步”   。 如有必要，选择“上一步”以返回并修复任何错误  。  

5. 在“创建应用程序向导”的“常规信息”  页上，指定以下信息：  

    > [!NOTE]  
    > 如果 Configuration Manager 从应用程序安装文件中自动检测到此信息，则此信息已填充在此处。 此外，显示的选项可能会因创建的应用程序类型而异。  

    - 有关应用程序的常规信息，如应用程序名称、管理员备注、发布服务器和软件版本     。 若要帮助在 Configuration Manager 控制台中查找应用程序，请指定“可选引用”，或选择“管理类别”   。  

    - **安装程序**：指定安装应用程序部署类型所需的安装程序和任何必需属性。  

        > [!TIP]  
        > 如果未显示安装程序，请选择“浏览”并浏览到安装程序位置  。  

    - **安装行为**：选择三个选项之一，确定 Configuration Manager 如何安装此部署类型。 有关这些选项的详细信息，请参阅[用户体验](#bkmk_dt-ux)。  

    - **使用自动 VPN 连接（如果已配置）** ：如果已将 VPN 配置文件部署到用户启动应用的设备，请在应用启动时连接 VPN。 此选项仅适用于 Windows 8.1 和 Windows Phone 8.1。 在 Windows Phone 8.1 设备上，如果有多个 VPN 配置文件部署到设备，则不支持自动 VPN 连接。 有关详细信息，请参阅 [VPN 配置文件](../../protect/deploy-use/vpn-profiles.md)。  

    - **为设备上的所有用户预配此应用程序**<!--1358310-->：为设备上的所有用户预配包含 Windows 应用包的应用程序。 有关详细信息，请参阅[创建 Windows 应用程序](../get-started/creating-windows-applications.md#bkmk_provision)。  

       > [!Tip]  
       > 如果要修改现有应用程序，则此设置位于 Windows 应用包部署类型属性的“用户体验”选项卡上  。  

6. 选择“下一步”  ，查看“摘要”  页上的应用程序信息，然后完成“创建应用程序向导”。  

新应用程序现在显示在 Configuration Manager 控制台的“应用程序”节点中  。 已完成创建应用程序。

若要添加更多部署类型或配置其他设置，请参阅[为应用程序创建部署类型](#bkmk_create-dt)。  

### <a name="manually-specify-application-information"></a><a name="bkmk_manual-app"></a> 手动指定应用程序信息  

1. 在“创建应用程序向导”的“常规”  页上，选择“手动指定应用程序信息”  ，然后选择“下一步”  。  

2. 指定关于应用程序的常规信息  ：  

    - 应用程序名称是必需的，并且必须少于 256 个字符  。  

    - 管理员备注、发布服务器和软件版本是用于进一步描述应用程序的其他元数据    。  

    - 若要帮助在 Configuration Manager 控制台中查找应用程序，请指定“可选引用”，或选择“管理类别”   。  

    - 发布日期   

    - 选择负责此应用程序的用户或组作为所有者和支持联系人   。 默认情况下，这些值设置为用户名。  

3. 在“创建应用程序向导”的“软件中心”  页上，指定以下信息：  

    > [!Note]  
    > 在版本 1902 及更早版本中，此页名为“应用程序目录”  。

    - **所选语言**：在下拉列表中，选择要设置的应用程序的语言版本。 选择“添加/删除”  ，为此应用程序设置更多语言。  

    - **本地化的应用程序名称**：用所选语言指定应用程序名称。  

        > [!IMPORTANT]  
        > 必须为设置的每个语言版本指定一个本地化应用程序名称。  

    - **用户类别**：选择“编辑”以指定所选语言的应用程序类别  。 软件中心的用户使用这些类别来帮助对应用程序进行筛选和排序。  

        > [!Note]  
        > 在版本1902 及更早版本中，用户类别仅适用于部署到用户集合。 如果将某个应用程序部署到计算机集合，则会忽略用户类别。
        >
        > 从版本 1906 开始，以设备为目标的应用程序部署的用户类别在软件中心现显示为筛选器。 这些部署可以是可用的，也可以是必需的。
        >
        > <!-- 4726793 -->重命名或删除类别不会自动应用于具有此类别的应用。 这些更改适用于下一个修订版的应用。 解决重命名或删除问题：
        >
        > - 首先，在引用该类别的任何应用上清除其复选框。 然后应用此更改，修改应用。
        >     - 接下来使用新名称新建类别，并将新类别添加到相关应用，而不是进行重命名操作。
        >     - 修改应用后，可以删除类别。

    - **用户文档**：指定文件的位置，软件中心用户可从中获取有关此应用程序的详细信息。 此位置是网站地址或网络路径和文件名称。 请确保用户有权访问此位置。  

    - **链接文本**：指定在指定用户文档时显示的用于取代“其他信息”的文本。  

    - **隐私 URL**：指定应用程序隐私声明的网站地址。  

    - **本地化的描述**：用所选语言输入此应用程序的说明。  

    - **关键字**：用所选语言输入关键字列表。 这些关键字帮助软件中心用户搜索应用程序。  

    - **图标**：选择“浏览”  为此应用程序选择一个图标。 如果不指定图标，Configuration Manager 将使用默认图标。 图标像素尺寸最大为 512x512。  

4. 在“创建应用程序”向导的“部署类型”  页上，选择“添加”  创建一个新部署类型。 有关详细信息，请参阅[为应用程序创建部署类型](#bkmk_create-dt)。  

5. 选择“下一步”  ，查看“摘要”  页上的应用程序信息，然后完成“创建应用程序向导”。  

新应用程序现在显示在 Configuration Manager 控制台的“应用程序”节点中  。  

## <a name="create-deployment-types-for-the-application"></a><a name="bkmk_create-dt"></a> 为应用程序创建部署类型  

如果[自动检测应用程序信息](#bkmk_auto-app)，则可能不需要完成本节中的某些步骤。  

> [!Note]  
> 查看现有部署类型的属性时，以下各节对应于部署类型属性窗口的选项卡：  
>
> - [内容](#bkmk_dt-content)
> - [任务序列](#bkmk_dt-ts)
> - [检测方法](#bkmk_dt-detect)
> - [用户体验](#bkmk_dt-ux)
> - [惠?](#bkmk_dt-require)
> - [返回代码](#bkmk_dt-return)
> - [依赖关系](#bkmk_dt-depend)
>  
> 有关部署类型属性上的“安装行为”选项卡的信息，请参阅[检查正在运行的可执行文件](deploy-applications.md#bkmk_exe-check)  。  

### <a name="start-the-create-deployment-type-wizard"></a>启动“创建部署类型向导”  

可通过三种方法启动“创建部署类型向导”：

- **在“应用程序”节点中**：在 Configuration Manager 控制台中，转到“软件库”工作区，展开“应用程序管理”，然后选择“应用程序”节点    。 选择一个应用程序，然后选择功能区中的“创建部署类型”  。  

- **创建应用程序时**：在“创建应用程序向导”中[手动指定应用程序信息](#bkmk_manual-app)时，选择“部署类型”页上的“添加”  。  

- **在应用程序属性中**：在“应用程序”  节点中选择现有应用程序，然后选择“属性”  。 切换到“部署类型”选项卡，然后选择“添加”   。

然后使用下列过程之一来[自动识别](#bkmk_auto-dt)或[手动指定](#bkmk_manual-dt)部署类型信息。  

### <a name="automatically-identify-deployment-type-information"></a><a name="bkmk_auto-dt"></a> 自动识别部署类型信息  

1. 在“创建部署类型向导”的“常规”页上  ：  

    1. 选择应用程序安装文件“类型”以检测部署类型信息  。  

    2. 选择“从安装文件中自动识别有关此部署类型的信息”  。  

    3. 在“位置”框中，指定要用于检测部署类型信息的应用程序安装文件  。 此位置是网络路径 (`\\server\share\filename`) 或应用商店链接。 对于网络路径以及包含应用程序内容的任何子文件夹，用户必须具有访问权限。  

2. 在“创建部署类型向导”的“导入信息”页上，查看信息，然后选择“下一步”   。 如有必要，选择“上一步”以返回并修复任何错误  。  

3. 在“创建部署类型向导”的“常规信息”  页上，指定以下信息：  

    > [!NOTE]  
    > 如果从应用程序安装文件中读取了某些部署类型信息，则可能已经存在这些信息。 此外，显示的选项可能会因创建的部署类型而异。  

    - 关于部署类型的“常规信息”  ：  
        - “名称”是必填项   

        - “管理员备注”可提供进一步描述   

        - “语言”提供可用语言   

    - **安装程序**：指定安装部署类型所需的安装程序和任何属性。  

    - **安装行为**：选择三个选项之一，确定 Configuration Manager 如何安装此部署类型。 有关这些选项的详细信息，请参阅[用户体验](#bkmk_dt-ux)。  

    - **使用自动 VPN 连接（如果已配置）** ：如果已将 VPN 配置文件部署到用户启动应用的设备，请在应用启动时连接 VPN。 此选项仅适用于 Windows 8.1 和 Windows Phone 8.1。 在 Windows Phone 8.1 设备上，如果有多个 VPN 配置文件部署到设备，则不支持自动 VPN 连接。 有关详细信息，请参阅 [VPN 配置文件](../../protect/deploy-use/vpn-profiles.md)。  

4. 选择“下一步”，然后继续[部署类型内容选项](#bkmk_dt-content)  。  

### <a name="manually-specify-the-deployment-type-information"></a><a name="bkmk_manual-dt"></a> 手动指定部署类型信息  

1. 在“创建部署类型向导”的“常规”页上，在“类型”下拉列表中，为此部署类型选择应用程序安装文件类型   。

2. 选择“手动指定部署类型信息”，然后选择“下一步”   。

3. 在“创建部署类型向导”的“常规信息”页上，指定部署类型“名称”   。 （可选）指定“管理员备注”，选择此部署类型的“语言”，然后选择“下一步”    。  

4. 继续[部署类型内容选项](#bkmk_dt-content)。  

### <a name="deployment-type-content-options"></a><a name="bkmk_dt-content"></a> 部署类型“内容”选项   

在“内容”页上，指定下列信息  ：  

> [!Note]  
> 查看现有部署类型的属性时，其中某些选项显示在“内容”选项卡上，而有些选项显示在“程序”选项卡上   。  

- **内容位置**：指定此部署类型的内容的位置，或选择“浏览”以选择部署类型内容文件夹  。  

    > [!IMPORTANT]  
    > 站点服务器计算机的系统帐户必须具有所指定内容位置的权限。  

  - **保留客户端缓存中的内容**：Configuration Manager 客户端无限期保留其缓存中的部署类型内容。 即使已安装应用，客户端仍然保留内容。 此选项对于某些部署非常有用，例如基于 Windows Installer 的软件。 Windows Installer 需要源内容的本地副本以应用更新。 此选项会减少可用缓存空间。 如果选择此选项，在缓存没有充足可用空间的情况下，可能会导致大型部署稍后失败。  

- **安装程序**：指定安装程序的名称和任何必需的安装参数。  

  - **安装开始于**：（可选）指定具有部署类型的安装程序的文件夹。 此文件夹可以是客户端上的绝对路径，或具有安装文件的分发点文件夹的路径。  

- **卸载程序**：（可选）指定卸载程序的名称和任何所需参数。  

  - **卸载开始于**：（可选）指定具有部署类型的卸载程序的文件夹。 此文件夹可以是客户端上的绝对路径。 也可以是包所在文件夹的分发点上的相对路径。  

- **修复程序**：对于 Windows Installer 和脚本安装程序部署类型，可以选择指定修复程序的名称和任何所需参数。<!--1357866-->  

  - **修复开始于**：（可选）指定具有部署类型的修复程序的文件夹。 此文件夹可以是客户端上的绝对路径。 也可以是包所在文件夹的分发点上的相对路径。  

- **在 64 位客户端上以 32 位进程形式运行安装和卸载程序**：使用基于 Windows 的计算机上的 32 位文件和注册表位置来运行部署类型的安装程序。  

#### <a name="deployment-type-properties-content-options"></a>部署类型属性“内容”选项 

查看部署类型的属性时，以下选项仅出现在“内容”选项卡上  ：

- **卸载内容设置**：  

  - **与安装内容相同**：如果安装和卸载内容相同，请选择此选项。 此选项为默认设置。  

  - **无卸载内容**：如果应用程序不需要卸载内容，请选择此选项。  

  - **与安装内容不同**：如果卸载内容与安装内容不同，请选择此选项。  

    - **卸载内容位置**：指定用于卸载应用程序的内容的网络路径。  

- **允许客户端使用来自默认站点边界组的分发点**：指定在无法从当前或相邻边界组中的分发点获得内容时，客户端是否应从站点默认边界组中的分发点下载并安装软件。  

- **部署选项**：指定在使用相邻或默认站点边界组中的分发点时，客户端是否应下载应用程序。  

- **允许客户端与同一子网上的其他客户端共享内容**：指定是否为内容下载启用 BranchCache。 有关详细信息，请参阅 [BranchCache](../../core/plan-design/hierarchy/fundamental-concepts-for-content-management.md#branchcache)。 BranchCache 始终在客户端上启用。 此设置已在版本 1802 中删除，因为只要分发点支持，客户端就会使用 BranchCache。  

### <a name="deployment-type-task-sequence-options"></a><a name="bkmk_dt-ts"></a> 部署类型“任务序列”选项 

<!--3555953-->

有关从版本 2002 开始的任务序列部署类型的详细信息，请参阅[任务序列部署类型](../get-started/creating-windows-applications.md#bkmk_tsdt)。

在“任务序列”页面上，指定以下信息  ：

- **安装任务序列**：选择运行此应用的安装过程的任务序列。

- **卸载任务序列**（可选）：选择删除此应用的任务序列。

> [!TIP]  
> 如果任务序列未出现在列表中，请仔细检查它是否不包含任何 OS 部署或 OS 升级步骤。 此外，确认它是否未标记为影响重大的任务序列。 有关详细信息，请查看[任务序列部署类型](../get-started/creating-windows-applications.md#bkmk_tsdt)的先决条件。

### <a name="deployment-type-detection-method-options"></a><a name="bkmk_dt-detect"></a> 部署类型“检测方法”选项 

此过程设置用于指示部署类型状态的检测方法。 换句话说，Windows 设备是否已安装应用程序。 使用以下两种方法之一创建检测方法：

- [配置对此部署类型的状态进行检测的规则](#bkmk_detect-rule)
- [使用自定义脚本检测此部署类型的状态](#bkmk_detect-script)

#### <a name="configure-rules-to-detect-the-presence-of-this-deployment-type"></a><a name="bkmk_detect-rule"></a> 配置对此部署类型的状态进行检测的规则

1. 在“检测方法”页上，默认选择“配置对此部署类型的状态进行检测的规则”选项   。 选择“添加子句”  。  

2. 在“检测规则”对话框中，选择“设置类型”以检测部署类型的状态   ：  

    - **文件系统**：检测设备上是否存在指定的文件或文件夹。 此检测表示已安装应用程序。 指定以下其他详细信息：  

        - **类型**：选择是文件还是文件夹。  

        - **路径**（必填）：输入或浏览到包含文件或文件夹的设备上的本地路径。 例如，`C:\Program Files`。 无法指定共享网络路径。 如果选择“浏览”，则浏览本地文件系统或连接到代表客户端进行浏览  。  

        - **文件或文件夹名称**（必填）：指定要在以上路径中检测的特定文件或文件夹名称。 如果客户端在设备上检测到此文件或文件夹，则会将该应用程序视为已安装在设备上。  

        - **此文件或文件夹与 64 位系统中的 32 位应用程序相关联**：默认情况下选择此选项。 客户端首先检查 32 位文件位置中是否存在指定文件或文件夹。 如果未找到此文件或文件夹，则客户端搜索 64 位位置。  

    - **注册表**：检测客户端设备上是否存在指定的注册表项或注册表值。 此检测表示已安装应用程序。 指定以下其他详细信息：  

        - **配置单元**（必填）：从下拉列表中选择注册表配置单元。 例如，`HKEY_LOCAL_MACHINE`。  

        - **项**（必填）：指定要在上述配置单元中搜索的注册表项。 例如，`SOFTWARE\Microsoft\Office`。  

        - **值**（可选）：输入要在上述项中检测的特定值。 如果希望客户端检测（默认）值，请启用“使用(默认)注册表项值进行检测”选项  。 输入值或启用此选项时，需要选择“数据类型”  。  

        - **此注册表项与 64 位系统上的 32 位应用程序相关联**：选择此选项可首先检查指定注册表项的 32 位注册表位置。 如果未找到注册表项，则客户端搜索 64 位位置。  

    - **Windows Installer**：检测客户端设备上是否存在指定的 Windows Installer 文件。 此检测表示已安装应用程序。 指定 MSI“产品代码”以在客户端上检测  。 如果选择“浏览”，请选择要从其中读取产品代码的 MSI 文件  。

3. 在“检测规则”窗口的底部，指定项目必须存在还是满足规则。 例如，如果检测到文件，默认情况下选择以下选项：**为了指明此应用程序的状态，目标系统上必须存在文件系统设置**。 选择另一个选项以根据文件或文件夹属性创建检测规则。 这些属性包括修改日期、创建日期、版本或大小。 每个设置类型的这些规则标准各不相同。  

4. 选择“确定”以关闭“检测规则”对话框   。  

如果创建多个检测方法用于一个部署类型，可以通过将子句组合在一起来创建更复杂的逻辑。  

#### <a name="group-detection-clauses-optional"></a>组合检测方法子句（可选） 

1. 对一个部署类型创建三个或更多检测方法子句。  

2. 依次选择两个或更多连续子句和“组合”  。 你会看到关联列中添加有括号，用于指明组的开始位置和结束位置。  

    例如：

    | 连接器  |  ( | 子句           |  )  |
    |------------|----|------------------|-----|
    |            |    | MSI 产品代码 |     |
    | 或         | (  | file1.text 存在|     |
    | 且        |    | file2.txt 存在 | )   |

3. 若要删除组，请依次选择已组合的子句和“取消组合”  。  

继续  转到下一部分，了解如何将自定义脚本用作检测方法。 或跳到  部署类型对应的[“用户体验”](#bkmk_dt-ux)选项。

#### <a name="use-a-custom-script-to-check-for-the-presence-of-a-deployment-type"></a><a name="bkmk_detect-script"></a> 使用自定义脚本检查部署类型的状态  

1. 在“检测方法”页上，选择“使用自定义脚本检测此部署类型的状态”框   。 然后选择“编辑”  。  

2. 在“脚本编辑器”  对话框中，选择“脚本类型”  ，以检测部署类型：PowerShell、VBScript 或 JScript。  

    > [!Note]  
    > 当 Windows PowerShell 脚本作为应用检测方法运行时，Configuration Manager 客户端会使用 `-NoProfile` 参数调用 PowerShell。 此选项在没有配置文件的情况下启动 PowerShell。 PowerShell 配置文件是在 PowerShell 启动时运行的脚本。 <!--3607762-->  

3. 在“脚本内容”框中，输入想要使用的脚本，或粘贴现有脚本的内容  。 选择“打开”，浏览到已保存的现有脚本  。 选择“清除”，删除脚本内容字段中的文本  。 如有必要，启用选项“在 64 位客户端上以 32 位进程形式运行脚本”  。  

    > [!NOTE]  
    > 脚本的最大大小为 32 KB。  

4. 选择“确定”以保存脚本并关闭“脚本编辑器”对话框   。 返回“创建部署类型向导”，“脚本类型”和“脚本长度”字段更新，其中包含有关脚本的详细信息   。

#### <a name="about-custom-script-detection-methods"></a>关于自定义脚本检测方法  

Configuration Manager 检查脚本的结果。 读取脚本写入到标准输出 (STDOUT) 流、标准错误 (STDERR) 流和退出代码的值。 如果脚本以非零值退出，则脚本失败，并且应用程序检测状态为“未知”  。 如果退出代码为零，并且 STDOUT 具有数据，则应用程序检测状态为“已安装”  。

> [!TIP]
> 编写检测脚本时，如果返回零退出代码但不返回输出（STDOUT 中的数据），则不会检测到应用程序已安装。 有关详细信息，请参阅下列示例。

使用下表检查是否从脚本的输出安装了应用程序：  

##### <a name="zero-exit-code"></a>零退出代码

|STDOUT|STDERR|脚本结果|应用程序检测状态|
|---------|---------|---------|---------|
|空|空|成功|未安装|
|空|不为空|失败|Unknown|
|不为空|空|成功|已安装|
|不为空|不为空|成功|已安装|

##### <a name="non-zero-exit-code"></a>非零退出代码

|STDOUT|STDERR|脚本结果|应用程序检测状态|
|---------|---------|---------|---------|
|空|空|失败|Unknown|
|空|不为空|失败|Unknown|
|不为空|空|失败|Unknown|
|不为空|不为空|失败|Unknown|

##### <a name="examples"></a>示例

使用下面的 PowerShell/VBScript 示例编写自己的应用程序检测脚本：  

**示例 1**：脚本返回不为零的退出代码。 此代码表示脚本未成功运行。 在这种情况下，应用程序检测状态为未知。  

``` PowerShell
Exit 1
```

``` VBScript
WScript.Quit(1)
```

**示例 2**：脚本返回的退出代码为零，但是 STDERR 的值不为空。 此结果表示脚本未成功运行。 在这种情况下，应用程序检测状态为未知。  

``` PowerShell
Write-Error "Script failed"
Exit 0
```

``` VBScript
WScript.StdErr.Write "Script failed"
WScript.Quit(0)
```

**示例 3**：脚本返回的退出代码为零，表示它已成功运行。 但是，STDOUT 的值为空，这表示未安装应用程序。  

``` PowerShell
Exit 0
```

``` VBScript
WScript.Quit(0)
```

**示例 4**：脚本返回的退出代码为零，表示它已成功运行。 STDOUT 的值不为空，这表示安装了应用程序。  

``` PowerShell
Write-Host "The application is installed"
Exit 0
```

``` VBScript
WScript.StdOut.Write "The application is installed"
WScript.Quit(0)
```

**示例 5**：脚本返回的退出代码为零，表示它已成功运行。 STDOUT 和 STDERR 的值不为空，这表示安装了应用程序。  

``` PowerShell
Write-Host "The application is installed"
Write-Error "Completed"
Exit 0
```

``` VBScript
WScript.StdOut.Write "The application is installed"
WScript.StdErr.Write "Completed"
WScript.Quit(0)
```

### <a name="deployment-type-user-experience-options"></a><a name="bkmk_dt-ux"></a> 部署类型“用户体验”选项 

这些设置指定客户端将应用程序安装到设备上的方式和用户看到的内容。  

在“用户体验”  页上，指定下列信息：  

- **安装行为**：在下拉列表中，选择下列选项之一：  

  - **针对用户安装**：客户端仅针对部署应用程序的用户安装应用程序。  

  - **针对系统安装**：客户端仅安装一次应用程序。 面向所有用户提供。  

  - **如果资源是设备，则针对系统安装；否则针对用户安装**：如果将应用程序部署到设备，则客户端会为所有用户安装该应用程序。 如果将应用程序部署到用户，则客户端仅为该用户安装应用程序。  

- **登录要求**：选择下列选项之一：  

  - **仅当用户登录时**  

  - **无论用户是否登录**  

  - **仅当无用户登录时**  

    > [!NOTE]  
    > 此选项默认为“仅当用户登录时”  。 如果在“安装行为”下拉列表中选择“针对用户安装”，则无法更改此选项   。  

- **安装程序可见性**：指定部署类型在客户端设备上运行的模式。 选择下列选项之一：  

  - **最大化**：部署类型在客户端设备上以最大化模式运行。 用户将看到所有安装活动。  

  - **常规**：部署类型基于系统和程序默认值在正常模式下运行。 此模式为默认模式。  

  - **最小化**：部署类型在客户端设备上以最小化模式运行。 用户可能会在通知区域或任务栏中看到安装活动。  

  - **隐藏**：部署类型在客户端设备上以隐藏模式运行。 用户看不到安装活动。  

- **允许用户查看程序安装并与之交互**：指定用户是否可以与部署类型安装交互以设置安装选项。  

    如果在“安装行为”  下拉列表中选择了“针对用户安装”  选项，则默认情况下启用此选项。  

    > [!IMPORTANT]  
    > 当选择“针对系统安装”行为时，此设置可选  。 此更改主要是为了允许最终用户在任务序列期间与安装进行交互。 例如，运行安装过程会提示最终用户各种选项。 某些应用程序安装程序无法关闭用户提示或安装过程需要仅用户知道的特定配置值。 <!--1356976-->  
    >  
    > 在系统环境中安装并允许用户与安装交互不是安全配置。 有关详细信息，请参阅[应用程序管理的安全和隐私](../plan-design/security-and-privacy-for-application-management.md#bkmk_interact)。  

- **最大允许运行时间(分钟)** ：指定预计部署类型在客户端计算机上运行的最长时间（以分钟为单位）。 将此设置指定为一个大于零的整数。 默认值为 120 分钟（两个小时）。  

    将此值用于以下操作：  

  - 监视部署类型中的结果。  

  - 检查在客户端设备上定义维护时段时是否安装部署类型。 当处于维护时段时，只有在维护时段中有足够的可用时间来容纳“最大允许运行时间”设置时，部署类型才会运行  。  

    > [!IMPORTANT]  
    > 如果“最大允许运行时间”  比计划维护时段长，则可能会发生冲突。 如果用户设置的最大运行时间超过了任何可用维护时段，则该部署类型不会运行。  

- **估计安装时间(分钟)** ：指定部署类型的估计安装时间。 用户会在软件中心内看到此时间。  

#### <a name="deployment-type-properties-user-experience-options"></a>部署类型属性“用户体验”选项 

查看部署类型的属性时，以下选项仅出现在“用户体验”选项卡上  ：

强制执行特定的安装后行为。 选择下列选项之一：  

- **根据返回代码确定行为**：根据[返回代码](#bkmk_dt-return)选项卡上配置的代码处理重启。软件中心显示“可能需要重新启动”  。 如果用户在安装期间登录，系统会进行提示，具体取决于部署的“用户体验”配置  。  

- **无特定操作**：安装后无需重新启动。 软件中心报告无需重新启动。  

- **软件安装程序可能会强制设备重启**：Configuration Manager 不会控制或发起重启，但实际安装时可能会执行此操作，而不发出警告。 安装程序发起重新启动时，使用此设置阻止 Configuration Manager 报告安装失败。 软件中心显示“可能需要重新启动”  。  

- **Configuration Manager 客户端将强制设备必须重新启动**：成功安装后，Configuration Manager 会强制重启设备。 软件中心报告需要重新启动。 如果用户在安装期间登录，系统会进行提示，具体取决于部署的“用户体验”配置  。  

### <a name="deployment-type-requirements"></a><a name="bkmk_dt-require"></a> 部署类型“要求” 

Configuration Manager 在安装部署类型之前验证设备上的这些要求。 使用要求可进一步优化和控制接收此应用程序的设备或用户。 例如，如果将应用程序部署到用户集合，请在此处指定应用的硬件要求。

1. 在“要求”页上，选择“添加”以打开“创建要求”对话框    。  

2. 从“类别”下拉列表中，选择此要求是针对设备还是用户    。  

    或者，选择“自定义”以使用以前创建的全局条件  。 选择“自定义”  时，也可以选择“创建”  以创建新的全局条件。 有关全局条件的详细信息，请参阅[如何创建全局条件](create-global-conditions.md)。  

    > [!IMPORTANT]  
    > 如果将应用程序部署到设备集合，则客户端将忽略“用户”类别和“主要设备”条件的任何要求   。  

3. 在“条件”下拉列表中，选择用于评估用户或设备是否满足安装要求的条件  。 根据所选类别，此列表的内容有所不同。  

4. 在“运算符”下拉列表中，选择要使用的运算符  。 此运算符将所选的条件与指定的值进行比较。 它可评估用户或设备是否满足安装要求。 可用运算符将因所选条件而异。  

    > [!Note]  
    > 可用要求因部署类型所使用的设备类型而异。  

5. 在“值”框中，指定要用于比较的值  。 这些值与所选条件和运算符一起用于评估用户或设备是否满足安装要求。 可用值因所选条件和所选运算符而异。  

6. 选择“确定”  以保存要求并关闭“创建要求”  对话框。  

### <a name="deployment-type-dependencies"></a><a name="bkmk_dt-depend"></a> 部署类型“依赖关系”   

依赖关系定义客户端在安装部署类型之前必须先安装的另一个应用程序中的一个或多个部署类型。

> [!IMPORTANT]  
> 在某些情况下，部署类型依赖于同时具有依赖关系的部署类型。 链中受支持的依赖关系链的最大数量为 5。  

1. 在“依赖关系”页上，选择“添加”   。  

2. 在“添加依赖关系”窗口中，输入“依赖关系组名称”  。 此名称引用此应用程序依赖关系组。  

3. 在“添加依赖关系”窗口中，选择“添加”  。  

4. 在“指定所需的应用程序”窗口中，选择要用作依赖关系的可用应用程序及其至少一个部署类型  。  

    > [!TIP]  
    > 选择“查看”以显示所选应用程序或部署类型的属性  。  

5. 选择“确定”以关闭“指定所需的应用程序”窗口   。  

6. 如果想要客户端自动安装相关的应用程序，请选择依赖关系旁边的“自动安装”  。  

    > [!NOTE]  
    > 若要自动安装，则不需要为客户端部署相关应用程序。  

7. 如果添加多个依赖关系，请使用“提高优先级”和“降低优先级”按钮   。 这些操作更改客户端评估每个依赖项的顺序。  

8. 选择“确定”以关闭“添加依赖关系”窗口   。  

### <a name="deployment-type-return-codes"></a><a name="bkmk_dt-return"></a> 部署类型“返回代码” 

> [!Note]  
> 此页不在“创建部署类型向导”中。 它只是现有部署类型属性上的选项卡。  

指定返回代码可控制部署类型完成后的行为。 例如，发出信号需要重启，那么安装完成。

1. 在部署类型属性窗口的“返回代码”选项卡上，选择“添加”   。  

2. 在“添加返回代码”窗口中，指定来自此部署类型的预期“返回代码值”  。 此值是 `-2147483648` 和 `2147483647` 之间的任何正整数或负整数。  

3. 从下拉列表中选择一个“代码类型”  。 此设置定义 Configuration Manager 如何解释此部署类型的指定返回码。 可用类型因部署类型技术而异。  

    - **成功(无需重启)** ：已成功安装部署类型，无需重启。  

    - **失败(无需重启)** ：部署类型安装失败。  

    - **硬重启**：已成功安装部署类型，但需要重启设备。 在设备重启之前，无法安装任何其他内容。  

    - **软重启**：已成功安装部署类型，但请求重启设备。 在设备重启之前，可以进行其他安装。  

    - **快速重试**：另一安装已在设备上进行。 客户端每两小时重试一次，共重试 10 次。  

4. （可选）为此返回代码输入名称和描述   。

5. 选择“确定”以关闭“添加返回代码”窗口  。  

#### <a name="example-non-zero-success"></a>示例：非零成功

要部署在成功安装时返回退出代码 `1` 的应用程序。 默认情况下，Configuration Manager 将此非零返回代码检测为失败。 指定返回代码值 `1`，然后选择代码类型“成功(不重启)”  。 现在，Configuration Manager 将该返回代码解释为此部署类型成功。

#### <a name="default-return-codes"></a>默认返回代码

创建某些部署类型时，Configuration Manager 自动添加该技术通用的以下返回代码：  

##### <a name="windows-installer-msi-file"></a>Windows Installer（\*.msi 文件）

|值    |代码类型|
|---------|---------|
|0        |成功(不重启)|
|1707     |成功(不重启)|
|3010     |软重启|
|1641     |硬重启|
|1618     |快速重试|

##### <a name="script-installer"></a>脚本安装程序

|值    |代码类型|
|---------|---------|
|0        |成功(不重启)|
|1641     |硬重启|
|3010     |软重启|
|1618     |快速重试|

##### <a name="windows-app-package-appx-appxbundle-msix-msixbundle"></a>Windows 应用包（\*.appx、\*.appxbundle、\*.msix、\*.msixbundle）

|值    |代码类型|
|---------|---------|
|15605    |快速重试|
|15618    |快速重试|

## <a name="additional-options-for-app-v-deployment-types"></a><a name="bkmk_appv"></a> App-V 部署类型的其他选项  

配置虚拟应用程序 (App-V) 的部署类型所特有的其他选项。  

### <a name="app-v-deployment-type-content-options"></a><a name="bkmk_appv-content"></a> App-V 部署类型“内容”选项   

1. 在 Configuration Manager 控制台中，转到“软件库”工作区，展开“应用程序管理”，然后选择“应用程序”节点    。  

2. 选择具有 App-V 部署类型的应用程序，然后选择“属性”  。  

3. 在应用程序属性中，切换到“部署类型”选项卡  。选择 App-V 部署类型，然后选择“编辑”  。  

4. 在部署类型属性中，切换到“内容”选项卡  。根据需要配置以下选项：  

    - **保留客户端缓存中的内容**：Configuration Manager 客户端不会从其缓存中删除此部署类型的内容。  

    - **启动前将内容加载到 App-V 缓存中**：应用程序启动之前，Configuration Manager 客户端会将此部署类型的所有内容加载到 App-V 缓存中。 客户端不会将内容固定在缓存中。 它在必要时删除内容。  

5. 选择“确定”以关闭部署类型属性  。 然后选择“确定”以关闭应用程序属性  。  

### <a name="app-v-deployment-type-publishing-options"></a><a name="bkmk_appv-pub"></a> App-V 部署类型“发布”选项 

1. 在 Configuration Manager 控制台中，转到“软件库”工作区，展开“应用程序管理”，然后选择“应用程序”节点    。  

2. 选择具有 App-V 部署类型的应用程序，然后选择“属性”  。  

3. 在应用程序属性中，切换到“部署类型”选项卡  。选择 App-V 部署类型，然后选择“编辑”  。  

4. 在部署类型属性中，切换到“发布”选项卡  。选择想要发布的虚拟应用程序中的项目。  

5. 选择“确定”以关闭部署类型属性  。 然后选择“确定”以关闭应用程序属性  。  

## <a name="import-an-application"></a><a name="bkmk_import"></a> 导入应用程序  

使用下列过程将应用程序导入 Configuration Manager：

1. 在 Configuration Manager 控制台中，转到“软件库”工作区，展开“应用程序管理”，然后选择“应用程序”节点    。  

2. 在功能区中的“主页”选项卡和“创建”组上，选择“导入应用程序”    。  

3. 在“导入应用程序向导”的“常规”页上，指定要导入的“文件”的网络路径   。 例如，`\\server\share\file.zip`。 此文件是导出的 Configuration Manager 应用程序的有效压缩存档（ZIP 格式）。  

4. 在“文件内容”页上，选择在此应用程序与现有应用程序重复的情况下要进行的操作  。 创建新应用程序，或忽略重复项并将新的修订添加到现有应用程序。  

5. 在“摘要”页上，查看操作，然后完成向导  。  

新应用程序会出现在“应用程序”  节点中。  

> [!TIP]  
> Windows PowerShell cmdlet **Import-CMApplication** 具有与此过程相同的功能。 有关详细信息，请参阅 [Import-CMApplication](https://docs.microsoft.com/powershell/module/configurationmanager/import-cmapplication?view=sccm-ps)。  

有关如何导出应用程序的详细信息，请参阅[应用程序的管理任务](management-tasks-applications.md)。

## <a name="supported-deployment-types"></a><a name="bkmk_deploy-types"></a> 支持的部署类型  

Configuration Manager 支持以下应用程序部署类型：

| 部署类型名称 | 说明 |
|--------------------------|----------------------|  
| **Windows Installer（\*.msi 文件）** | Windows Installer 文件。 |  
| **Windows 应用包（\*.appx、\*.appxbundle、\*.msix、\*.msixbundle）** | Windows 应用包文件 (.appx)、Windows 应用捆绑包 (.appxbundle)、Windows 10 应用包 (.msix) 或 Windows 10 应用捆绑包 (.msixbundle)。<!--1357427--> |  
| **Windows 应用包（在 Windows 应用商店中）** | 指定指向 Windows 应用商店中的应用的链接，或浏览应用商店以选择应用。<sup>[注释 1](#bkmk_note1)</sup> |  
| **脚本安装程序** | 指定在 Windows 客户端上运行的脚本或程序，以安装内容或执行操作。 将此部署类型用于 setup.exe 安装程序或脚本包装器。 |  
| **Microsoft Application Virtualization 4** | Microsoft App-V v4 清单。 |  
| **Microsoft Application Virtualization 5** | Microsoft App-V v5 包文件。 |  
| **Windows Phone 应用包（\*.xap 文件）** | Windows Phone 应用包文件。 |  
| **Windows Phone 应用包（在 Windows Phone 应用商店中）** | 指定指向 Windows 应用商店中的应用的链接。 |  
| **Mac OS X** | 适用于运行 Configuration Manager 客户端的 macOS 计算机。 创建具有 CMAppUtil 工具的 .cmmac 文件  。 |  
| **Web 应用程序** | 指定指向 Web 应用程序的链接。 此部署类型在用户的设备上安装 Web 应用程序的快捷方式。 |  
| **通过 MDM 的 Windows Installer (\*.msi)** | 创建基于 Windows Installer 的应用并将其部署到 Windows 10 设备。 有关详细信息，请参阅[将 Windows Installer 应用部署到已注册 MDM 的 Windows 10 设备](../get-started/creating-windows-applications.md#bkmk_mdm-msi)。 |
| **任务序列** | 从版本 2002 开始，可使用任务序列安装或卸载复杂的应用程序。 有关详细信息，请参阅[任务序列部署类型](../get-started/creating-windows-applications.md#bkmk_tsdt)。 <!--3555953--> |

> [!NOTE]
> Configuration Manager 控制台可能会显示其他部署类型，但这些部署类型适用的平台不再受支持。 有关详细信息，请参阅[混合出了什么问题？](../../mdm/understand/what-happened-to-hybrid.md)。

### <a name="note-1-windows-app-package-in-the-windows-store"></a><a name="bkmk_note1"></a> 注释 1：Windows 应用包（在 Windows 应用商店中）

若要以指向 Windows 应用商店的链接的形式部署应用，请配置组策略“关闭应用商店应用程序”  。 将此策略设置为“已禁用”或“未配置”   。 如果启用此设置，客户端无法连接到 Windows 应用商店来下载和安装应用程序。

Windows 客户端始终在其他部署类型之前评估使用指向应用商店的链接的部署类型。 然后，客户端按优先级评估部署类型。

> [!TIP]
> 某些存储链接可能会导致“创建应用程序向导”中显示以下错误消息：“应用程序链接无效”。 例如，某些存储“特色应用”可能会导致此错误  。 仍可以在向导的“常规”页上，选择“下一步”   。 Configuration Manager 成功创建了应用，因此可以成功地部署它。<!-- SCCMDocs-pr #4716 -->

## <a name="next-steps"></a>后续步骤

在 Configuration Manager 中创建应用程序后，下一步是[部署应用程序](deploy-applications.md)。

从版本 1906 开始，创建一组可以作为单个部署发送到用户或设备集合的应用程序。 有关详细信息，请参阅[创建应用程序组](create-app-groups.md)。

有关在不同 OS 平台上创建应用程序的详细信息，请参阅以下文章：  

- [创建 Windows 应用程序](../get-started/creating-windows-applications.md)
- [创建 Mac 应用程序](../get-started/creating-mac-computer-applications.md)
- [创建 Linux 和 UNIX 服务器应用程序](../get-started/creating-linux-and-unix-server-applications.md)
- [创建 Windows Embedded 应用程序](../get-started/creating-windows-embedded-applications.md)
