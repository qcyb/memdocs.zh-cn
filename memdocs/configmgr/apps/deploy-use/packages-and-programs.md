---
title: 包和程序
titleSuffix: Configuration Manager
description: 支持使用与 Configuration Manager 配合使用的包和程序的部署。
ms.date: 07/26/2019
ms.prod: configuration-manager
ms.technology: configmgr-app
ms.topic: conceptual
ms.assetid: caad0507-9913-415a-b13d-d36f8f0a1b80
author: aczechowski
manager: dougeby
ms.author: aaroncz
ms.openlocfilehash: c87ae35fa3e5a76c57342a0d1cad4167b0f14685
ms.sourcegitcommit: e43e6e83e3b38137ceebc6d299eacd94a925db85
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/26/2020
ms.locfileid: "88895953"
---
# <a name="packages-and-programs-in-configuration-manager"></a>Configuration Manager 中的包和程序

适用范围：  Configuration Manager (Current Branch)

Configuration Manager 继续支持在 Configuration Manager 2007 中使用的包和程序。 部署以下任何工具或脚本时，使用包和程序的部署可能比使用某个应用程序的部署更适用：  

- 不在计算机上安装应用程序的管理工具
- 不需要持续监视的“一次性”脚本  
- 按定期计划运行且不能使用全局评估的脚本

> [!TIP]  
> 请考虑使用 Configuration Manager 控制台中的[脚本](create-deploy-scripts.md)功能。 在前面的某些场景中，相比于使用包和程序，脚本可能是一种更好的解决方案。

从较早版本的 Configuration Manager 迁移包时，可以将其部署在 Configuration Manager 层次结构中。 迁移完成后，包会出现在“软件库”  工作区的“包”  节点中。

可通过与使用软件分发时相同的方式来修改和部署这些包。 Configuration Manager 中保留了“从定义向导导入包”  ，以导入旧包。 从 Configuration Manager 2007 迁移到 Configuration Manager 层次结构时，播发将转换为部署。  

> [!NOTE]  
> 使用包转换管理器将包和程序转换为 Configuration Manager 应用程序。  
>
> 从版本 1806 开始，包转换管理器可与 Configuration Manager 集成。 有关详细信息，请参阅[包转换管理器](../pcm/package-conversion-manager.md)。  

包可以使用 Configuration Manager 的一些新功能，包括分发点组和监视。 无法在 Configuration Manager 中使用包和程序来部署 Microsoft Application Virtualization (App-V) 应用程序。 若要分发虚拟应用程序，请将其创建为 Configuration Manager 应用程序。 有关详细信息，请参阅[部署 App-V 虚拟应用程序](../get-started/deploying-app-v-virtual-applications.md)。  


## <a name="create-a-package-and-program"></a>创建包和程序

### <a name="use-the-create-package-and-program-wizard"></a>使用“创建包和程序向导”

1. 在 Configuration Manager 控制台中，转到“软件库”工作区，展开“应用程序管理”，然后选择“包”节点    。  

2. 在功能区的“主页”选项卡上的“创建”组中，选择“创建包”    。  

3. 在上 **包** 页 **创建包和程序向导**, ，指定以下信息：  

    - **名称**：指定包的名称，最多 50 个字符。  

    - **描述**：指定此包的描述，最多 128 个字符。  

    - **制造商**（可选）：指定制造商名称有助于在 Configuration Manager 控制台中识别包。 此名称最多包含 32 个字符。

    - **语言**（可选）：指定包的语言版本，最多 32 个字符。  

    - **版本**（可选）：指定包的版本号，最多 32 个字符。

    - **此包包含源文件**：此设置指示包是否要求在客户端设备上显示源文件。 默认情况下，此向导不启用该选项，并且 Configuration Manager 不使用包的分发点。 选择此选项时，请指定要分发到分发点的包内容。  

    - **源文件夹**：如果包包含源文件，请选择“浏览”打开“设置源文件夹”对话框，并指定包的源文件位置   。  

        > [!NOTE]  
        > 站点服务器的计算机帐户必须具有对你所指定源文件夹的读取访问权限。
        >
        > Windows 将源路径长度限制为不超过 256 个字符。 此限制同时适用于包源和应用程序。 有关详细信息，请参阅[命名文件、路径和命名空间](/windows/win32/fileio/naming-a-file)。

    - 从版本 1906 开始，如果要在客户端上预缓存内容，请指定包的“体系结构”**** 和“语言”****。 有关详细信息，请参阅[配置预缓存内容](../../osd/deploy-use/configure-precache-content.md)。<!--4224642-->  

4. 在“创建包和程序向导”**** 的“程序类型”**** 页上，选择要创建的程序类型，然后选择“下一步”****。 你可以为[计算机](#create-a-standard-program)或[设备](#create-a-device-program)创建程序，也可以跳过此步骤，稍后再进行创建。  

    > [!TIP]  
    > 若要创建现有包的新程序，首先选择包。 然后，在“主页”**** 选项卡的“包”**** 组中，选择“创建程序”**** 以打开“创建程序向导”****。  

#### <a name="create-a-standard-program"></a>创建标准程序

1. 在“创建包和程序向导”的****“程序类型”**** 页上，选择“标准程序”****，然后选择“下一步”****。  

2. 在“标准程序”**** 页上，指定下列信息：  

    - **名称**：指定程序的名称，最多 50 个字符。  

        > [!NOTE]  
        > 程序名称必须是唯一的包中。 在创建程序之后，无法修改其名称。  

    - **命令行**：输入用于启动此程序的命令行，或选择“浏览”**** 以浏览至文件位置。  

        如果没有指定文件名的扩展，则 Configuration Manager 将尝试使用 .com、.exe 和 .bat 作为可能的扩展。  

        客户端运行程序时，Configuration Manager 在以下位置搜索文件：

        - 包中
        - 本地 Windows 文件夹
        - 本地 %path%

        如果找不到该文件，程序将失败。  

    - **启动文件夹**（可选）：指定程序运行的文件夹，最多 127 个字符。 此文件夹可以是客户端上的绝对路径。 也可以是相对于包含包的分发点文件夹的路径。

    - **运行**：指定程序在客户端计算机上的运行模式。 选择以下选项之一：  

        - **普通**：程序以基于系统和程序默认值的普通模式运行。 此模式为默认模式。  

        - **最小化**：程序在客户端设备上以最小化模式运行。 用户可以在通知区域或任务栏中看到安装活动。  

        - **最大化**：程序在客户端设备上以最大化模式运行。 用户将看到所有安装活动。  

        - **隐藏**：程序在客户端设备上以隐藏模式运行。 用户看不到任何安装活动。  

    - **程序可以运行**：指定程序是仅当用户登录到客户端计算机时才运行、仅当无用户登录时才运行、还是无论用户是否登录都运行。  

    - **运行模式**：指定程序是在使用管理权限时还是使用当前登录用户的权限时运行。  

    - **允许用户查看程序安装并与之交互**：若可用，使用此设置指定是否允许用户与程序安装交互。 仅当满足以下条件时才可使用此选项：

        - “程序可以运行”设置为“仅当无用户登录时”或“无论用户是否登录”  
        - “运行模式”设置为“使用管理权限运行”   

    - **驱动器模式**：指定有关此程序在网络上如何运行的信息。 选择以下选项之一：  

        - **使用 UNC 名称运行**：指定程序以通用命名约定 (UNC) 名称运行。 此设置为默认设置。  

        - **要求驱动器号**：指定程序要求驱动器号完全符合其位置。 对于此设置，Configuration Manager 可以使用客户端上任何可用的驱动器号。  

        - **要求特定驱动器号**：指定程序要求所指定的特定驱动器号完全符合其位置。 例如，Z:****。 如果客户端已在使用指定的驱动器号，则该程序不会运行。  

    - **登录时重新连接到分发点**：指示客户端是否在用户登录时重新连接到分发点。 默认情况下，向导不启用此选项。

3. 在“创建包和程序向导”的“要求”页上指定以下信息：  

    - **首先运行其他程序**：标识在此包和程序运行之前运行的包和程序。  

    - **平台要求**：选择“此程序可以在任何平台上运行”或“此程序只能在指定的平台上运行” 。 然后选择客户端必须具备的 OS 版本来安装该包和程序。  

    - **估计磁盘空间**：指定程序在计算机上运行所需的磁盘空间量。 默认设置为“未知”****。 如有必要，请指定一个大于或等于零的整数。 如果设置了值，则还要选择值的单位。  

    - **最大允许运行时间(分钟)**：指定预计程序在客户端计算机上运行的最长时间。 默认值为 120**** 分钟。 仅使用大于零的整数。  

        > [!IMPORTANT]  
        > 如果在程序部署到的同一集合中使用维护时段，当“最大允许运行时间”大于计划的维护时段时，则可能发生冲突。 如果最大运行时间设置为“未知”，则程序将在维护时段启动。 然后，在维护时段关闭后，它会根据需要继续运行。 如果将最大运行时间设置为特定时段，且该特定时段大于任何可用的维护时段长度，则客户端不会运行该程序。  

        如果将该值设置为“未知”****，则 Configuration Manager 会将最大允许运行时间设置为 12 小时（720 分钟）。  

        > [!NOTE]  
        > 如果程序超过最大运行时间，则 Configuration Manager 在满足以下条件时会将其停止：
        >
        > - 启用“使用管理权限运行”选项
        > - 不启用“允许用户查看程序安装并与之交互”选项  

#### <a name="create-a-device-program"></a>创建设备程序  

1. 在“创建包和程序向导”**** 的“程序类型”**** 页上，选择“设备程序”****，然后选择“下一步”****。  

2. 在“设备程序”**** 页上，指定以下设置：  

    - **名称**：指定程序的名称，最多 50 个字符。  

        > [!NOTE]  
        > 程序名称必须是唯一的包中。 在创建程序之后，无法修改其名称。  

    - **备注**（可选）：指定此设备程序的注释，最多 127 个字符。  

    - **下载文件夹**：指定设备上用于存储包源文件的文件夹名称。 默认值为 `\Temp\`。  

    - **命令行**：输入用于启动此程序的命令行。 若要浏览到文件位置，请选择“浏览”。  

    - **在下载文件夹中运行命令行**：选择此选项从下载文件夹中运行程序。  

    - **从此文件夹中运行命令行**：选择此选项以指定用于运行程序的其他文件夹。  

3. 在“要求”**** 页上，指定以下设置：  

    - **估计磁盘空间**：指定软件所需的磁盘空间量。 客户端在移动设备用户安装程序之前向其显示此值。  

    - **下载程序**：指定有关移动设备何时可以下载此程序的信息。 你可以指定“尽快” ****、“仅通过快速网络” ****、或“仅当设备插接时” ****。  

    - **附加要求**：为此程序指定任何附加要求。 用户在安装软件之前会看到这些要求。 例如，可以通知他们需要在运行该程序之前关闭所有其他应用程序的用户。  

## <a name="deploy-packages-and-programs"></a>部署包和程序  

1. 在 Configuration Manager 控制台中，转到“软件库”工作区，展开“应用程序管理”，然后选择“包”节点************。  

2. 选择要部署的包。 在功能区的“主页”**** 选项卡上的“部署”**** 组中，选择“部署”****。  

3. 在“部署软件向导”的“常规”页面上，指定要部署的包和程序的名称 。 选择要将包和程序部署到其上的集合，以及任何可选注释。  

    若要在集合的默认分发点组上存储包内容，请选择“使用与此集合关联的默认分发点组”****。 若未将此集合与分发点组关联，则该选项不可用。  

4. 在“内容”页，选择“添加” 。 选择要将此包和程序的内容分发到的分发点或分发点组。  

5. 在“部署设置”页面上配置下列设置：  

    - **目的**：选择下列选项之一：

        - **可用**：用户可在软件中心看到发布的包和程序，并可根据需要进行安装。  

        - **必需**：包和程序会根据配置的计划自动进行部署。 在软件中心，你可以跟踪其部署状态，并在截止时间前进行安装。  

        > [!NOTE]
        > 如果多个用户登录设备，软件中心内可能无法显示包和任务序列部署。

    - **发送唤醒数据包**：如果将部署目的设置为“必需”并选择此选项，则站点首先会在安装截止时间向计算机发送唤醒数据包。 必须将计算机配置为 LAN 唤醒才能使用此选项。 有关详细信息，请参阅[如何配置 LAN 唤醒](../../core/clients/deploy/configure-wake-on-lan.md)。  

    - **允许客户端使用按流量计费的 Internet 连接在安装截止时间之后下载内容，这可能会导致附加成本**  

    > [!NOTE]  
    > 部署包和程序时，“将软件预先部署到用户的主要设备”选项不可用。****  

6. 在“计划”页面上，配置将此包和程序部署到客户端设备的时间。  

    此页上的选项将有所不同，具体取决于将部署操作设置为“可用”**** 还是“必需”****。  

    对于“必需”部署，则可通过“重新运行行为”下拉菜单来配置程序的重新运行行为 。 从以下选项中选择：  

    | 重新运行行为 | 描述 |
    |----------------|-------------|
    | **从不重新运行已部署的程序** | 客户端不会重新运行程序。 即使原来程序运行失败或者已更改程序文件，也会重新运行该程序。 |
    | **始终重新运行程序** | 计划部署时，客户端始终重新运行程序。 即使程序已成功运行，也会执行此行为。 这对于更新程序时定期进行部署非常有用。 |
    | **如果上次尝试失败则重新运行** | 仅当上次运行尝试失败时，客户端才会在计划部署时重新运行程序。 |
    | **如果上次尝试成功则重新运行** | 仅当上次在客户端上成功运行时，客户端才会重新运行程序。 定期更新程序的情况下，该行为有助于定期进行部署，并且每个更新都要求成功安装上一更新。 |

7. 在“用户体验”  页上，指定下列信息：  

    - **允许用户独立于分配运行程序**：用户可以在不考虑任何计划安装时间的情况下从软件中心安装此软件。  

    - “软件安装”****：允许在任何已配置维护时段外安装软件。  

    - **系统重启(若为完成安装所需)**：如果软件安装要求重启设备才能完成，则允许在任何已配置维护时段外执行此操作。  

    - **Embedded 设备**：将包和程序部署到启用了写入筛选器的 Windows Embedded 设备时，可以指定将包和程序安装在临时覆盖区上并稍后提交更改。 或者，在安装截止时间或在维护时段内提交更改。 如果在安装截止时间或维护时段内提交更改，则需要重新启动，且更改将保留在设备上。  

        > [!NOTE]  
        > 将包或程序部署到 Windows Embedded 设备时，确保设备是配置了维护时段的集合的成员。 有关向 Windows Embedded 设备部署包和程序时如何使用维护时段的详细信息，请参阅[创建 Windows Embedded 应用程序](../get-started/creating-windows-embedded-applications.md)。  

8. 在“分发点”  页上，指定下列信息：  

    - **部署选项**：指定客户端在其当前边界组中使用分发点时的操作。 客户端使用相邻边界组或默认站点边界组中的分发点时，还应选择对该客户端进行的操作。

        > [!IMPORTANT]  
        > 如果将部署选项配置为“从分发点运行程序”，则在包属性的“数据访问”选项卡上，请确保启用“将此包中的内容复制到分发点上的包共享”选项  。 否则，无法从分发点运行包。  

    - **允许客户端使用默认站点边界组中的分发点**：当前或相邻边界组中的分发点中的内容不可用时，启用此选项以尝试使用站点默认边界组中的分发点。

9. 完成向导。  

当你选择部署时，可以在“监视”工作区的“部署”节点和包部署选项卡的详细信息窗格中查看部署********。 有关详细信息，请参阅[监视包和程序](#monitor-packages-and-programs)。  


## <a name="monitor-packages-and-programs"></a>监视包和程序

若要监视包和程序部署，可以使用与监视应用程序相同的过程，如[监视应用程序](monitor-applications-from-the-console.md)中所详述。  

包和程序还包含大量内置报表，可用于监视有关包和程序部署状态的信息。 这些报表的报表类别为“软件分发 - 包和程序” **** 和“软件分发 - 包和程序部署状态” ****。  

有关如何在 Configuration Manager 中配置报表的详细信息，请参阅[报表简介](../../core/servers/manage/introduction-to-reporting.md)。  


## <a name="manage-packages-and-programs"></a>管理包和程序

在“软件库”工作区，展开“应用程序管理”，然后选择“包”节点************。 选择要管理的包，然后选择一个管理任务。  

### <a name="create-prestage-content-file"></a>创建预留内容文件

打开“创建预留内容文件向导”，创建包含包内容的文件。 使用此文件将包手动导入到远程分发点。 此操作在站点服务器与分发点之间的网络带宽较低的情况下很有用。

### <a name="create-program"></a>创建程序

打开“创建程序向导”****，该向导可用于创建此包的新程序。

### <a name="export"></a>导出

打开“导出包向导”****，该向导可用于将所选包及其内容导出到文件。 使用此文件将文件导入到另一个层次结构。

有关如何导入包和程序的信息，请参阅[创建包和程序](#create-a-package-and-program)。

### <a name="deploy"></a>部署

打开“部署软件向导”****，该向导可用于将所选包和程序部署到集合。 有关详细信息，请参阅[部署包和程序](#deploy-packages-and-programs)。

### <a name="distribute-content"></a>分发内容

打开“分发内容向导”，将包和程序的内容发送到所选的分发点或分发点组。

### <a name="update-distribution-points"></a>更新分发点

与所选的包和程序的最新内容更新分发点。


## <a name="see-also"></a>另请参阅

- [脚本](create-deploy-scripts.md)

- [包转换管理器](../pcm/package-conversion-manager.md)

- [包定义文件](package-definition-files.md)
